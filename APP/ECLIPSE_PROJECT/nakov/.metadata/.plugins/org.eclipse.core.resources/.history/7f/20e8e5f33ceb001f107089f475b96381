<?xml version="1.0" encoding="iso-8859-1"?>

<project name="DigitalSignerApplet" default="build" basedir=".">

	<!-- inicializacao das variaveis/constantes -->
    <target name="init">
    	<property name="applet-name" value="DigitalSignerApplet.jar"/>
    	<property name="classes-dir" value="bin"/>
    	<property name="deploy-dir" value="deploy"/>
    	<property name="certificate-name" value="SignApplet.jks"/>
    	<property name="certificate-dir" value="certificate"/>
    	<property name="applet-full-name" value="${deploy-dir}/${applet-name}"/>
    	<property name="keystore-certificate" value="${certificate-dir}/${certificate-name}"/>
    	<property name="storepass-certificate" value="!secret"/>
    	<property name="keypass-certificate" value="!secret"/>
    	<property name="alias-certificate" value="signFiles"/>
    </target>

	<!-- limpa o diretorio de deploy -->
    <target name="clean" depends="init">
        <delete dir="${deploy-dir}"/>
        <delete dir="${certificate-dir}"/>
        <mkdir dir="${deploy-dir}"/>
        <mkdir dir="${certificate-dir}"/>
    </target>

	<!-- generates a new jks certificate -->
	<target name="generates-a-new-certificate-jks" depends="init">
		<exec executable="C:/Program Files (x86)/Java/jdk1.6.0_14/jre/bin/keytool" failonerror="true">
			<arg value="-genkey"/>
			<arg value="-alias signFiles"/>
			<arg value="-keystore DigitalSignerApplet.jks"/>
			<arg value="-keypass !secret"/>
			<arg value='-dname "CN=Compania Jean Bruno Teste"'/>
			<arg value="-storepass !secret"/>
		</exec>
	</target>
	
	<!-- creates the jar applet -->
	<target name="creates-jar-applet" depends="init">
		<jar destfile="${applet-full-name}">
			<fileset dir="${classes-dir}"/>
		</jar>
	</target>
	
	<!-- signs the jar applet -->
	<target name="sign-jar-applet" depends="init">
		<signjar jar="${applet-full-name}"
				keystore="${keystore-certificate}"
				storepass="${storepass-certificate}"
				keypass="${keypass-certificate}"
				alias="${alias-certificate}"
				lazy="false"/>
	</target>

	<!-- main line command -->
    <target name="build">
        <antcall target="clean"/>
        <antcall target="generates-a-new-certificate-jks"/>
        <antcall target="creates-jar-applet"/>
        <antcall target="sign-jar-applet"/>
    </target>

</project>
