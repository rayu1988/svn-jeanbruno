<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_18) on Sun Mar 28 11:21:17 BRT 2010 -->
<TITLE>
Exemplos (ICP-Bravo API)
</TITLE>

<META NAME="date" CONTENT="2010-03-28">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../../icpbravo.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="Exemplos (ICP-Bravo API)";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>

					
					<img src=../../../../../../img/LogoGrande.png><br>
					<b>Vers&atilde;o 1.20</b></a>
					
				</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../br/com/oaks/ICPBravo/AlvoDigital.html" title="class in br.com.oaks.ICPBravo"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.SSLClientImpl.html" title="class in br.com.oaks.ICPBravo"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../index.html?br/com/oaks/ICPBravo/Exemplos.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="Exemplos.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;<A HREF="#nested_class_summary">NESTED</A>&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
br.com.oaks.ICPBravo</FONT>
<BR>
Class Exemplos</H2>
<PRE>
java.lang.Object
  <IMG SRC="../../../../resources/inherit.gif" ALT="extended by "><B>br.com.oaks.ICPBravo.Exemplos</B>
</PRE>
<DL>
<DT><B>Direct Known Subclasses:</B> <DD><A HREF="../../../../br/com/oaks/ICPBravo/AlvoDigital.html" title="class in br.com.oaks.ICPBravo">AlvoDigital</A>, <A HREF="../../../../br/com/oaks/ICPBravo/ExemplosTCU.html" title="class in br.com.oaks.ICPBravo">ExemplosTCU</A>, <A HREF="../../../../br/com/oaks/ICPBravo/MCT8.html" title="class in br.com.oaks.ICPBravo">MCT8</A>, <A HREF="../../../../br/com/oaks/ICPBravo/MTE.html" title="class in br.com.oaks.ICPBravo">MTE</A>, <A HREF="../../../../br/com/oaks/ICPBravo/Testes.html" title="class in br.com.oaks.ICPBravo">Testes</A></DD>
</DL>
<HR>
<DL>
<DT><PRE>public class <B>Exemplos</B><DT>extends java.lang.Object</DL>
</PRE>

<P>
<script type="text/javascript" src="../../../../../../scripts/shCore.js"></script>
 <script type="text/javascript" src="../../../../../../scripts/shBrushCSharp.js"></script>
 <script type="text/javascript" src="../../../../../../scripts/shBrushCss.js"></script>
 <script type="text/javascript" src="../../../../../../scripts/shBrushDiff.js"></script>
 <script type="text/javascript" src="../../../../../../scripts/shBrushJava.js"></script>
 <script type="text/javascript" src="../../../../../../scripts/shBrushJScript.js"></script>
 <script type="text/javascript" src="../../../../../../scripts/shBrushPlain.js"></script>
 <script type="text/javascript" src="../../../../../../scripts/shBrushXml.js"></script>
 <link type="text/css" rel="stylesheet" href="../../../../../../styles/shCore.css"/>
 <link type="text/css" rel="stylesheet" href="../../../../../../styles/shThemeMidnight.css"/>
 <script type="text/javascript">
        SyntaxHighlighter.config.clipboardSwf = '../../../../../../scripts/clipboard.swf';
        SyntaxHighlighter.all();
 </script>
 
 A classe a seguir demonstra alguns exemplos do uso da API ICP-Bravo. <br>
 <br>
 <a href=
 '../../../../../../samples/br/com/oaks/ICPBravo/Exemplos.java'>Download
 Exemplos.java</a> <br>
 Para compilar os exemplos, salve-o em %DIRETORIO_SAMPLE/br/com/oaks/ICPBravo
 e dê o seguinte comando:
 
 <pre class="brush: js;">
 javac -classpath %PATH_DA_ICPBravoAPI\ICPBravoAPI.jar;%DIRETORIO_SAMPLE br\com\oaks\ICPBravo\Exemplos.java
 </pre>
 
 <br>
 Para executar os exemplos, dê o seguinte comando:
 
 <pre class="brush: js;">
 java -classpath %PATH_DA_ICPBravoAPI\ICPBravoAPI.jar;%DIRETORIO_SAMPLE br.com.oaks.ICPBravo.Exemplos
 </pre>
 
 <br>
 Onde %DIRETORIO_SAMPLE é o diretório onde será realizado o teste e
 %PATH_DA_ICPBravoAPI é o diretório que contém a API do ICPBravo.
<P>

<P>
<HR>

<P>
<!-- ======== NESTED CLASS SUMMARY ======== -->

<A NAME="nested_class_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Nested Class Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;class</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.SSLClientImpl.html" title="class in br.com.oaks.ICPBravo">Exemplos.SSLClientImpl</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;class</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.SSLServerWithClientAuthId.html" title="class in br.com.oaks.ICPBravo">Exemplos.SSLServerWithClientAuthId</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
</TABLE>
&nbsp;<!-- =========== FIELD SUMMARY =========== -->

<A NAME="field_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Field Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;java.lang.String</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#host">host</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#sslPort">sslPort</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
</TABLE>
&nbsp;
<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Constructor Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#Exemplos()">Exemplos</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Method Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;java.lang.String</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#autenticaUsuario(java.lang.String, java.lang.String)">autenticaUsuario</A></B>(java.lang.String&nbsp;challenge,
                 java.lang.String&nbsp;pkcs7)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O seguinte exemplo busca orientar a construção do código de servidor para a validação de uma assinatura em ambiente
 de autenticação de usuário com certificado digital.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#changeTrustedChain()">changeTrustedChain</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Demonstração de alteração da cadeia de confiança ao testar se um certificado é confiável.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;<A HREF="../../../../br/com/oaks/ICPBravo/certs/ICPBravoCertificate.html" title="class in br.com.oaks.ICPBravo.certs">ICPBravoCertificate</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#criaCertificadoRaiz(java.util.Date, java.util.Date)">criaCertificadoRaiz</A></B>(java.util.Date&nbsp;from,
                    java.util.Date&nbsp;to)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Método chamado para criação de certificado Raiz.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#criaCertificados()">criaCertificados</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O teste a seguir cria os certificados necessários para o teste
 
 Serão criados 3 certificados, sendo um de raiz e dois de usuário.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#inicializaTeste()">inicializaTeste</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Cria um novo manager de dispositivo (no caso é utilizado um para
 JavaKeyStore) e pega seu provider, que será utilizado no decorrer dos
 testes.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#main(java.lang.String[])">main</A></B>(java.lang.String[]&nbsp;args)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Roda os testes.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#mostraInformacoesCertificado(br.com.oaks.ICPBravo.certs.ICPBravoCertificate)">mostraInformacoesCertificado</A></B>(<A HREF="../../../../br/com/oaks/ICPBravo/certs/ICPBravoCertificate.html" title="class in br.com.oaks.ICPBravo.certs">ICPBravoCertificate</A>&nbsp;cert)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Mostra as informações de um certificado X509.V3.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaAssinaturaDePDF()">testaAssinaturaDePDF</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O teste a seguir demonstrará uma característica de assinatura de PDF.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaCertificadoPEM()">testaCertificadoPEM</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Teste que permite a leitura e criação de certificados a partir de PEM Encoded.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaCertificadoX509v2()">testaCertificadoX509v2</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Testa a geração e verificação de um certificado no padrão X509 v.2 (CRL).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaCertificadoX509v3()">testaCertificadoX509v3</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Testa a geração e verificação de um certificado no padrão X509 v.3, em
 conformidade com a ICP-Brasil.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaCertificadoX509v3Expirado()">testaCertificadoX509v3Expirado</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Verifica um certificado expirado.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaCifrasAssimetricas()">testaCifrasAssimetricas</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Testa algumas das cifras simétricas da API, como RSA com 1024, 2048 e 4096
 bits e o Diffie Hellman.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaCifrasSimetricas()">testaCifrasSimetricas</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Testa algumas das cifras simétricas da API, como DES (CBC/ECB), TripleDES
 com 112 e 168 bits (ECB/CBC), AES com 128, 192 e 256 bits (ECB/CBC), RC4 e
 RC2 (ECB/CBC).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaCSR()">testaCSR</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Teste que permite a criação de um CSR, e a criação de um certificado a partir do CSR.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaDiffieHellman()">testaDiffieHellman</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Testa o uso do algoritmo DiffieHelman para a troca de chave.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaDigest()">testaDigest</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Testa alguns dos algoritmos de digest da API, como MD5, SHA-1, SHA-2 (com
 256 e 512 bits) e o HMAC-SHA1.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaECDH()">testaECDH</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Demonstra o uso do algoritmo ECDH (Elliptic Curve Diffie-Hellman) para
 troca de chaves.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaEnvelopedData()">testaEnvelopedData</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O teste a seguir demonstrará um exemplo de CMS da API chamado de
 EnvelopedData.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaEnvelopesDigitais()">testaEnvelopesDigitais</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O teste a seguir demonstrará alguns exemplos de CMS da API, como
 SignedData, EnvelopedData e o SignedAndEnvelopedData.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaHMACSha1()">testaHMACSha1</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Testa a utilização do algoritmo HMAC-SHA1.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaLDAP()">testaLDAP</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Executa um teste das capacidades de integração da API com LDAP.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaNumerosAleatorios()">testaNumerosAleatorios</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Testa os geradores de números pseudo-aleatórios da API, como LFSR e SHA1-PRNG e o gerador nativo do Windows.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaPBE()">testaPBE</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Demonstra o uso da criptografia baseada em senhas.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaPKCS11()">testaPKCS11</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Demonstra a relação com os dispositivos criptográficos do tipo PKCS#11 <br>
 O código a seguir abrirá um PKCS#11 e mostrará todos os certificados
 dentro do dispositivo.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaPKCS12()">testaPKCS12</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Demonstra a relação com os dispositivos criptográficos do tipo PKCS#12.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaShamirSecretSharing()">testaShamirSecretSharing</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Demonstra o uso do algoritmo ShamirSecretSharing.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaSignedAndEnvelopedData()">testaSignedAndEnvelopedData</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O teste a seguir demonstrará um exemplo de CMS da API chamado de
 SignedAndEnvelopedData.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaSignedData()">testaSignedData</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O teste a seguir demonstrará um exemplo de CMS da API chamado de
 SignedData.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaSMIME()">testaSMIME</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Apresenta um envio de email assinado.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaSSL()">testaSSL</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Este exemplo cria um servidor SSL/TSL que aguarda uma conexão do cliente
 com certificado.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaSSLCriaCertificados()">testaSSLCriaCertificados</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Criar certificados e keystore para o teste de SSL.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>static&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.html#testaXmlDSig()">testaXmlDSig</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O teste a seguir demonstrará um exemplo de CMS da API chamado de
 SignedData.</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from class java.lang.Object</B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE>equals, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->

<A NAME="field_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Field Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="sslPort"><!-- --></A><H3>
sslPort</H3>
<PRE>
public static final int <B>sslPort</B></PRE>
<DL>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../../../constant-values.html#br.com.oaks.ICPBravo.Exemplos.sslPort">Constant Field Values</A></DL>
</DL>
<HR>

<A NAME="host"><!-- --></A><H3>
host</H3>
<PRE>
public static final java.lang.String <B>host</B></PRE>
<DL>
<DL>
<DT><B>See Also:</B><DD><A HREF="../../../../constant-values.html#br.com.oaks.ICPBravo.Exemplos.host">Constant Field Values</A></DL>
</DL>

<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Constructor Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="Exemplos()"><!-- --></A><H3>
Exemplos</H3>
<PRE>
public <B>Exemplos</B>()</PRE>
<DL>
</DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Method Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="testaCifrasSimetricas()"><!-- --></A><H3>
testaCifrasSimetricas</H3>
<PRE>
public static void <B>testaCifrasSimetricas</B>()</PRE>
<DL>
<DD>Testa algumas das cifras simétricas da API, como DES (CBC/ECB), TripleDES
 com 112 e 168 bits (ECB/CBC), AES com 128, 192 e 256 bits (ECB/CBC), RC4 e
 RC2 (ECB/CBC).
 <p>
 O teste criará um chave secreta e criptografará e decriptografará um array
 de bytes com esta chave.
 </p>
 
 <pre class="brush: java;">
 public static void testaCifrasSimetricas() {
        cron.zera();
        System.out.println(&quot;Testando as cifras simétricas&quot;);
        SymmetricAlgorithm[] algs = {new DESCBC(provider), new DESECB(provider),
 
        new TripleDES112ECB(provider), new TripleDES112CBC(provider), new TripleDES168ECB(provider), new TripleDES168CBC(provider),
 
        new AES128CBC(provider), new AES128ECB(provider), new AES192CBC(provider), new AES192ECB(provider), new AES256CBC(provider), new AES256ECB(provider),
 
        new RC4(provider),
 
        new RC2CBC(provider), new RC2ECB(provider),};
        byte[] bts = &quot;teste&quot;.getBytes();
 
        for (int a = 0; a &lt; algs.length; a++) {
                try {
                        Cronometro cron2 = new Cronometro();
 
                        SecretKey secKey = algs[a].generateKey();
                        cron2.marcaParcial(algs[a].toString() + &quot;: Chave gerada&quot;);
                        byte[] cr = algs[a].crypt(bts, secKey);
                        cron2.marcaParcial(algs[a].toString() + &quot;: Criptografado&quot;);
                        byte[] ret = algs[a].decrypt(cr, secKey);
                        cron2.marcaParcial(algs[a].toString() + &quot;: Decriptografado&quot;);
 
                        if (Arrays.equals(bts, ret)) {
                                cron2.marcaTotal(algs[a].toString() + &quot;: OK&quot;);
                        } else {
                                System.out.println(algs[a].toString() + &quot;: Falha&quot;);
                        }
                } catch (Exception e) {
                        System.out.println(algs[a].toString() + &quot;: Falha &quot; + e.getMessage());
                }
        }
        cron.marcaTotal(&quot;Fim de teste de algoritmo simétrico&quot;);
 }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando as cifras simétricas
DESEDE: Chave gerada (1311 ms)
DESEDE: Criptografado (54 ms)
DESEDE: Decriptografado (1 ms)
DESEDE: OK (1373 ms)
DESECB: Chave gerada (0 ms)
DESECB: Criptografado (1 ms)
DESECB: Decriptografado (0 ms)
DESECB: OK (7 ms)
3DES112ECB: Chave gerada (6 ms)
3DES112ECB: Criptografado (6 ms)
3DES112ECB: Decriptografado (1 ms)
3DES112ECB: OK (20 ms)
3DES112CBC: Chave gerada (0 ms)
3DES112CBC: Criptografado (1 ms)
3DES112CBC: Decriptografado (0 ms)
3DES112CBC: OK (8 ms)
3DES168ECB: Chave gerada (0 ms)
3DES168ECB: Criptografado (1 ms)
3DES168ECB: Decriptografado (0 ms)
3DES168ECB: OK (9 ms)
3DES168CBC: Chave gerada (0 ms)
3DES168CBC: Criptografado (0 ms)
3DES168CBC: Decriptografado (0 ms)
3DES168CBC: OK (9 ms)
AES128CBC: Chave gerada (70 ms)
AES128CBC: Criptografado (5 ms)
AES128CBC: Decriptografado (0 ms)
AES128CBC: OK (81 ms)
AES128ECB: Chave gerada (0 ms)
AES128ECB: Criptografado (2 ms)
AES128ECB: Decriptografado (1 ms)
AES128ECB: OK (10 ms)
AES192CBC: Chave gerada (0 ms)
AES192CBC: Criptografado (0 ms)
AES192CBC: Decriptografado (1 ms)
AES192CBC: OK (9 ms)
AES192ECB: Chave gerada (0 ms)
AES192ECB: Criptografado (1 ms)
AES192ECB: Decriptografado (1 ms)
AES192ECB: OK (9 ms)
AES256CBC: Chave gerada (0 ms)
AES256CBC: Criptografado (1 ms)
AES256CBC: Decriptografado (1 ms)
AES256CBC: OK (10 ms)
AES256ECB: Chave gerada (0 ms)
AES256ECB: Criptografado (6 ms)
AES256ECB: Decriptografado (1 ms)
AES256ECB: OK (14 ms)
RC4: Chave gerada (5 ms)
RC4: Criptografado (7 ms)
RC4: Decriptografado (0 ms)
RC4: OK (20 ms)
RC2CBC: Chave gerada (3 ms)
RC2CBC: Criptografado (8 ms)
RC2CBC: Decriptografado (0 ms)
RC2CBC: OK (20 ms)
RC2ECB: Chave gerada (0 ms)
RC2ECB: Criptografado (1 ms)
RC2ECB: Decriptografado (0 ms)
RC2ECB: OK (8 ms)
Fim de teste de algoritmo simétrico (1652 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaCifrasAssimetricas()"><!-- --></A><H3>
testaCifrasAssimetricas</H3>
<PRE>
public static void <B>testaCifrasAssimetricas</B>()</PRE>
<DL>
<DD>Testa algumas das cifras simétricas da API, como RSA com 1024, 2048 e 4096
 bits e o Diffie Hellman.
 <p>
 O teste criará um chave assimétrica e criptografará e decriptografará um
 array de bytes com esta chave.
 </p>
 
 <pre class="brush: java;">
 public static void testaCifrasAssimetricas() {
        cron.zera();
        System.out.println(&quot;Testando as cifras assimétricas&quot;);
        try {
                AsymmetricAlgorithm[] algs = {new RSA1024ECB(provider), new RSA2048ECB(provider), new RSA4096ECB(provider), new DiffieHellman(provider),};
                byte[] bts = &quot;teste&quot;.getBytes();
 
                for (int a = 0; a &lt; algs.length; a++) {
                        try {
                                Cronometro cron2 = new Cronometro();
 
                                KeyPair secKey = algs[a].generateKeyPair();
                                cron2.marcaParcial(algs[a].toString() + &quot;: Chave gerada&quot;);
                                byte[] cr = algs[a].crypt(bts, secKey.getPublic());
                                cron2.marcaParcial(algs[a].toString() + &quot;: Criptografado&quot;);
                                byte[] ret = algs[a].decrypt(cr, secKey.getPrivate());
                                cron2.marcaParcial(algs[a].toString() + &quot;: Decriptografado&quot;);
 
                                if (Arrays.equals(bts, ret)) {
                                        cron2.marcaTotal(algs[a].toString() + &quot;: OK&quot;);
                                } else {
                                        System.out.println(algs[a].toString() + &quot;: Falha&quot;);
                                }
                        } catch (Exception e2) {
                                System.out.println(algs[a].toString() + &quot;: Falha &quot; + e2.getMessage());
                        }
                }
        } catch (Exception e1) {
                System.out.println(&quot;testaCifrasAssimetricas: Falha &quot; + e1.getMessage());
        }
        cron.marcaTotal(&quot;Fim de teste de algoritmo assimétrico&quot;);
 }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando as cifras assimétricas
RSA1024: Chave gerada (1630 ms)
RSA1024: Criptografado (8 ms)
RSA1024: Decriptografado (31 ms)
RSA1024: OK (1676 ms)
RSA2048: Chave gerada (11676 ms)
RSA2048: Criptografado (6 ms)
RSA2048: Decriptografado (200 ms)
RSA2048: OK (11890 ms)
RSA4096: Chave gerada (106462 ms)
RSA4096: Criptografado (21 ms)
RSA4096: Decriptografado (1434 ms)
RSA4096: OK (107918 ms)
Fim de teste de algoritmo assimétrico (121492 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaDigest()"><!-- --></A><H3>
testaDigest</H3>
<PRE>
public static void <B>testaDigest</B>()</PRE>
<DL>
<DD>Testa alguns dos algoritmos de digest da API, como MD5, SHA-1, SHA-2 (com
 256 e 512 bits) e o HMAC-SHA1.
 <p>
 O teste criará um hash e verificará se o hash criado tem a quantidade de
 bytes esperado.
 </p>
 
 <pre class="brush: java;">
 public static void testaDigest() {
        cron.zera();
        System.out.println(&quot;Testando os algoritmos de integridade (digest)&quot;);
        DigestAlgorithm[] algs = {new MD5(provider), new SHA1(provider), new SHA256(provider), new SHA512(provider), new HMAC_SHA1(provider),};
        byte[] bts = &quot;teste&quot;.getBytes();
 
        for (int a = 0; a &lt; algs.length; a++) {
                try {
                        Cronometro cron2 = new Cronometro();
                        byte hash[] = algs[a].digest(bts);
                        if ((hash.length * 8) == algs[a].getKeySize())
                                cron2.marcaTotal(algs[a].toString() + &quot;: OK&quot;);
                        else
                                System.out.println(algs[a].toString() + &quot;: Falha&quot;);
                } catch (Exception e) {
                        System.out.println(algs[a].toString() + &quot;: Falha &quot; + e.getMessage());
                }
        }
        cron.marcaTotal(&quot;Fim de teste de algoritmo de integridade&quot;);
 }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando os algoritmos de integridade (digest)
MD5: OK (0 ms)
SHA1: OK (0 ms)
SHA256: OK (1 ms)
SHA512: OK (1 ms)
HMACSHA1: OK (1 ms)
Fim de teste de algoritmo de integridade (18 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaHMACSha1()"><!-- --></A><H3>
testaHMACSha1</H3>
<PRE>
public static void <B>testaHMACSha1</B>()</PRE>
<DL>
<DD>Testa a utilização do algoritmo HMAC-SHA1.
 <br>Neste teste criaremos uma chave secreta e a incluiremos junto com a mensagem
 para a geração do hash. 
 
 <pre class="brush: java;">
public static void testaHMACSha1() {
        cron.zera();
        System.out.println("Testando o algoritmo HMAC/SHA1");
        HMAC_SHA1 alg = new HMAC_SHA1(provider);
        byte[] bts = "teste".getBytes();

        try {
                Cronometro cron2 = new Cronometro();
                SecretKey sc = alg.generateKey();
                byte hash[] = alg.digest(sc, bts);
                if ((hash.length * 8) == alg.getKeySize())
                        cron2.marcaTotal(alg.toString() + ": OK");
                else
                        System.out.println(alg.toString() + ": Falha");
        } catch (Exception e) {
                System.out.println(alg.toString() + ": Falha " + e.getMessage());
        }
        cron.marcaTotal("Fim de teste de algoritmo de integridade");
}
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando o algoritmo HMAC/SHA1
HMACSHA1: OK (10 ms)
Fim de teste de algoritmo de integridade (15 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaNumerosAleatorios()"><!-- --></A><H3>
testaNumerosAleatorios</H3>
<PRE>
public static void <B>testaNumerosAleatorios</B>()</PRE>
<DL>
<DD>Testa os geradores de números pseudo-aleatórios da API, como LFSR e SHA1-PRNG e o gerador nativo do Windows.
 <p>
 O teste criará uma sequência de números aleatórios com cada um dos
 algoritmos.
 </p>
 
 <pre class="brush: java;">
 public static void testaNumerosAleatorios() {
        cron.zera();
        System.out.println(&quot;Testando geração de números aleatórios&quot;);
        PRNG[] algs = {new LFSR(provider), new SHA1_PRNG(provider), new WindowsPRNG(provider)};
 
        for (int a = 0; a &lt; algs.length; a++) {
                try {
                        SecureRandom sr = algs[a].getRandom();
                        System.out.println(&quot;Gerando para &quot; + algs[a].toString() + &quot;: &quot;);
                        for (int b = 0; b &lt; 100; b++)
                                // gerar 100 números aleatórios
                                System.out.print(sr.nextInt(512) + &quot;, &quot;);
                        System.out.println(algs[a].toString() + &quot;: OK&quot;);
                } catch (Exception e) {
                        System.out.println(algs[a].toString() + &quot;: Falha &quot; + e.getMessage());
                }
        }
        cron.marcaTotal(&quot;Fim de teste de números aleatórios&quot;);
 }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando geração de números aleatórios
Gerando para LFSR: 
498, 182, 35, 345, 428, 55, 427, 195, 100, 427, 144, 310, 437, 446, 464, 322, 109, 196, 81, 444, 252, 115, 237, 24, 166, 125, 315, 18, 193, 152, 158, 239, 475, 246, 360, 356, 75, 43, 153, 35, 84, 446, 166, 208, 97, 112, 301, 156, 74, 225, 56, 236, 398, 171, 93, 157, 4, 192, 113, 261, 301, 340, 226, 250, 465, 401, 167, 103, 447, 508, 174, 469, 316, 76, 102, 231, 321, 176, 66, 387, 128, 389, 480, 317, 27, 254, 268, 198, 479, 323, 446, 224, 451, 65, 131, 295, 244, 373, 191, 102, LFSR: OK
Gerando para SHA1PRNG: 
411, 207, 175, 248, 496, 24, 164, 335, 76, 301, 112, 381, 433, 130, 38, 265, 201, 37, 354, 436, 445, 442, 405, 269, 301, 191, 419, 308, 100, 358, 395, 304, 236, 362, 187, 475, 72, 275, 41, 74, 144, 58, 414, 324, 31, 77, 227, 26, 380, 106, 77, 98, 283, 187, 475, 266, 106, 335, 253, 485, 399, 343, 396, 175, 72, 292, 430, 265, 168, 196, 341, 213, 184, 337, 104, 86, 328, 379, 344, 487, 490, 30, 203, 388, 484, 62, 58, 357, 268, 5, 321, 134, 138, 126, 60, 181, 419, 270, 0, 128, SHA1PRNG: OK
Gerando para WindowsPRNG: 
147, 344, 463, 373, 335, 312, 83, 464, 250, 121, 137, 79, 23, 50, 344, 164, 200, 17, 44, 184, 43, 4, 397, 203, 324, 34, 249, 68, 346, 489, 421, 173, 6, 312, 489, 227, 48, 165, 66, 468, 44, 48, 336, 17, 312, 267, 423, 180, 278, 283, 445, 249, 83, 258, 20, 456, 63, 414, 499, 377, 112, 121, 147, 192, 265, 4, 352, 506, 201, 41, 475, 278, 30, 90, 507, 457, 85, 66, 204, 90, 273, 318, 395, 216, 287, 281, 493, 210, 310, 406, 271, 134, 368, 490, 284, 120, 12, 58, 338, 78, WindowsPRNG: OK
Fim de teste de números aleatórios (31 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="mostraInformacoesCertificado(br.com.oaks.ICPBravo.certs.ICPBravoCertificate)"><!-- --></A><H3>
mostraInformacoesCertificado</H3>
<PRE>
public static void <B>mostraInformacoesCertificado</B>(<A HREF="../../../../br/com/oaks/ICPBravo/certs/ICPBravoCertificate.html" title="class in br.com.oaks.ICPBravo.certs">ICPBravoCertificate</A>&nbsp;cert)
                                         throws java.lang.Exception</PRE>
<DL>
<DD>Mostra as informações de um certificado X509.V3.
 
 <pre class="brush: java;">
        public static void mostraInformacoesCertificado(ICPBravoCertificate cert) throws Exception {
                System.out.println("Gerando certificado X509v3 - ICPBrasil : OK");
                System.out.println(cert.toString());
                System.out.println("é autoassinado: " + cert.isAutoSign());
                System.out.println("é certificador de sigilo: " + cert.isSecrecy());
                System.out.println("é ICPBrasil: " + cert.isICPBrasil());
                System.out.println("é raiz ICPBrasil: " + cert.isICPBrasilRoot());
                System.out.println("pode assinar: " + cert.canSign());
                System.out.println("crlSign: " + cert.isKeyUsageExtensionCrlSign());
                System.out.println("dataEncipherment: " + cert.isKeyUsageExtensionDataEncipherment());
                System.out.println("decipherOnly: " + cert.isKeyUsageExtensionDecipherOnly());
                System.out.println("encipherOnly: " + cert.isKeyUsageExtensionEncipherOnly());
                System.out.println("digitalSignature: " + cert.isKeyUsageExtensionDigitalSignature());
                System.out.println("keyAgreement: " + cert.isKeyUsageExtensionKeyAgreement());
                System.out.println("KeyCertisign: " + cert.isKeyUsageExtensionKeyCertisign());
                System.out.println("KeyEncipherment: " + cert.isKeyUsageExtensionKeyEncipherment());
                System.out.println("NonRepudiation: " + cert.isKeyUsageExtensionNonRepudiation());
                try {
                        cert.tryValidate();
                        System.out.println("certificado válido: OK");
                } catch (CertificadoExpiradoException e1) {
                        System.out.println("certificado válido: Falha " + e1.getMessage());
                } catch (InvalidCertificateException e1) {
                        System.out.println("certificado válido: Falha " + e1.getMessage());
                }
                try {
                        cert.tryTrustedValidate();
                        System.out.println("certificado confiável: OK");
                } catch (Exception e1) {
                        System.out.println("certificado confiável: Falha " + e1.getMessage());
                }
                try {
                        ICPBravoCA ac = cert.getIssuerObject();
                        if (ac != null) {
                                System.out.println("AC: " + ac.toString());
                                System.out.println("AC URL: " + ac.getURLCrl());
                                ICPBravoCRL crl = ac.getValidCRL(null, null);
                                System.out.println("CRL OK: " + crl.getThisUpdate() + " até " + crl.getNextUpdate());
                        } else
                                System.out.println("Não tem AC");
                } catch (Exception e) {
                        System.out.println("Falha na verificação de CRL " + e.toString());
                }
                Vector&lt;CertificateAttribute&gt; infoGerais = cert.getGeneralInformation();
                for (CertificateAttribute informacaoCertificado : infoGerais) {
                        System.out.println(informacaoCertificado.getDescription() + ": " + informacaoCertificado.getValue());
                }
                Vector&lt;CertificateAttribute&gt; infoIssuerDNKeys = cert.getIssuerDNKeys();
                for (CertificateAttribute informacaoCertificado : infoIssuerDNKeys) {
                        System.out.println(informacaoCertificado.getDescription() + ": " + informacaoCertificado.getValue());
                }
                Vector&lt;CertificateAttribute&gt; infoSubjectDNKeys = cert.getSubjectDNKeys();
                for (CertificateAttribute informacaoCertificado : infoSubjectDNKeys) {
                        System.out.println(informacaoCertificado.getDescription() + ": " + informacaoCertificado.getValue());
                }
                Vector&lt;CertificateAttribute&gt; infoSubjectAlternativeNameExtensions = cert.getSubjectAlternativeNamesExtensions();
                for (CertificateAttribute informacaoCertificado : infoSubjectAlternativeNameExtensions) {
                        System.out.println(informacaoCertificado.getDescription() + ": " + informacaoCertificado.getValue());
                }
                Vector&lt;CertificateAttribute&gt; infoKeyUsageExtensions = cert.getKeyUsageExtension();
                for (CertificateAttribute informacaoCertificado : infoKeyUsageExtensions) {
                        System.out.println(informacaoCertificado.getDescription() + ": " + informacaoCertificado.getValue());
                }
                Vector&lt;CertificateAttribute&gt; infoExtendedKeyUsageExtension = cert.getExtendedKeyUsageExtension();
                for (CertificateAttribute informacaoCertificado : infoExtendedKeyUsageExtension) {
                        System.out.println(informacaoCertificado.getDescription() + ": " + informacaoCertificado.getValue());
                }
                Vector&lt;CertificateAttribute&gt; infoPoliciesExtensions = cert.getCertificatePoliciesExtensions();
                for (CertificateAttribute informacaoCertificado : infoPoliciesExtensions) {
                        System.out.println(informacaoCertificado.getDescription() + ": " + informacaoCertificado.getValue());
                }
                Vector&lt;CertificateAttribute&gt; infoCRLDistributionPointsExtensions = cert.getCRLDistributionPointsExtensions();
                for (CertificateAttribute informacaoCertificado : infoCRLDistributionPointsExtensions) {
                        System.out.println(informacaoCertificado.getDescription() + ": " + informacaoCertificado.getValue());
                }
                Vector&lt;CertificateAttribute&gt; infoICPBrasil = cert.constroiSubjectAlternativeNamesExtensions();
                for (CertificateAttribute informacaoCertificado : infoICPBrasil) {
                        System.out.println(informacaoCertificado.getDescription() + ": " + informacaoCertificado.getValue());
                }
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 ps.: Algumas falhas nas verificações poderão ser observadas, por se tratar de um certificado de exemplo e não haver um servidor que comprove algumas verficações, como por exemplo CRL e cadeia de confiança.
 <pre class="brush: plain;">
Pessoa:12345678901
É autoassinado: false
É certificador de sigilo: false
É ICPBrasil: true
É raiz ICPBrasil: false
pode assinar: false
crlSign: false
dataEncipherment: false
decipherOnly: false
encipherOnly: false
digitalSignature: true
keyAgreement: false
KeyCertisign: false
KeyEncipherment: true
NonRepudiation: true
certificado válido: OK
certificado confiável: Falha Não foi possível encontrar o certificado Autoridade Certificadora Raiz Brasileira fake na lista de certificados confiáveis.
AC: Autoridade Certificadora Raiz Brasileira fake
AC URL: http://www.certificadodigital.oaks.com.br/repositorio/lcr/SerasaSRF.crl
Falha na verificação de CRL br.com.oaks.ICPBravo.exceptions.HttpErrorException: Erro de HTTP: http://www.certificadodigital.oaks.com.br/repositorio/lcr/SerasaSRF.crl
C: BR
O: ICP-Brasil
ST: DF
L: Brasilia
OU: Instituto Nacional de Tecnologia da Informacao fake - ITIf
CN: Autoridade Certificadora Raiz Brasileira fake
CN: Pessoa:12345678901
OU: OU
OU: Secretaria da Receita Federal fake - SRFf
O: ICP-Brasil
C: BR
campo otherName em certificado de pessoa física, contento os dados do titular (data de nascimento, CPF, PIS/PASEP/CI, RG); Res. 07, de 12.12.2001: 010220091234567890100000000000123456789090000SSPDf
campo otherName em certificado de pessoa física, contendo informações sobre o Título de Eleitor do titular; Res. 13, de 29.04.2002: 00000000000000000000000000000000000000000
campo otherName em certificado de pessoa física, contendo nas 12 posições o número do Cadastro Específico do INSS (CEI) da pessoa física titular do certificado; Res. 31, de 29.01.2004: 000000000000
IA5String: pessoa@oaktech.com.br
DigitalSignature: true
NonRepudiation: true
KeyEncipherment: true
DataEncipherment: false
KeyAgreement: false
KeyCertisign: false
ClrSign: false
EncipherOnly: false
DecipherOnly: false
ServerAuth: false
ClientAuth: true
CodeSigning: true
EmailProtection: true
IpsecEndSystem: false
IpsecTunnel: false
IpsecUser: false
TimeStamping: true
OCSPSigning: false
Dvcs: false
SbgpCertAAServerAuth: false
Scvp_responder: false
EapOverPPP: false
EapOverLAN: false
ScvpServer: false
ScvpClient: false
IpsecIKE: false
CapwapAC: false
CapwapWTP: false
Smartcardlogon: false
Política de Certificado de Assinatura Digital do Tipo A3 da AC SERASA SRF: http://www.certificadodigital.oaks.com.br/repositorio/dpc
cdp_0: http://www.certificadodigital.oaks.com.br/repositorio/lcr/SerasaSRF.crl
PF.Dt Nascimento: 01/02/2009
PF.CPF: 123.456.789-01
PF.NIS: 00000000000
PF.RG: 123456789090000
PF.OE: SSPDf
PF.Título Eleitor: 000000000000
PF.Zona: 000
PF.SessÒo: 0000
PF.Município/UF: 0000000000000000000000
PF.INSS: 000000000000
 </pre>
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>cert</CODE> - 
<DT><B>Throws:</B>
<DD><CODE>java.lang.Exception</CODE></DL>
</DD>
</DL>
<HR>

<A NAME="testaCertificadoX509v3()"><!-- --></A><H3>
testaCertificadoX509v3</H3>
<PRE>
public static void <B>testaCertificadoX509v3</B>()</PRE>
<DL>
<DD>Testa a geração e verificação de um certificado no padrão X509 v.3, em
 conformidade com a ICP-Brasil.
 <p>
 O teste criará o certifcado e em seguida apresentará no system.out as
 interfaces deste certificado.
 </p>
 
 <pre class="brush: java;">
        public static void testaCertificadoX509v3() {
                cron.zera();
                System.out.println("Testando geração de certificados X509 v3");
                Date from = ICPBravoUtil.getDateNow();
                Date to = ICPBravoUtil.getTo(ICPBravoUtil.MONTHS, 1);

                ICPBravoCertificateGenerator gen;
                try {
                        gen = new ICPBravoCertificateGenerator(manager.getProvider(), "Pessoa", BigInteger.valueOf(4), "Pessoa", certRoot, ICPBravoCertificateGenerator.getDefaultKeyUsageForFinal(),
                                        ICPBravoCertificateGenerator.getDefaultKeyPurposeForFinal(),
                                        "http://www.certificadodigital.oaks.com.br/repositorio/lcr/SerasaSRF.crl", OIWObjectIdentifiers.OID_ICPBrasilA3 + ".10",
                                        "http://www.certificadodigital.oaks.com.br/repositorio/dpc", "OU=SRF e-CPF fake,OU=Secretaria da Receita Federal fake - SRFf", null, null, 
                                        from, to, 
                                        new SignatureAlgorithm(manager.getProvider(), new SHA1(manager.getProvider()), new RSA1024ECB(manager.getProvider())), 
                                        "pessoa@oaktech.com.br", ICPBravoUtil.getDate(2009, 1, 1), // nascimento
                                        "12345678901", // cpf
                                        null, // nis
                                        "12345678909", // rg
                                        "SSPDf", // oe
                                        null, // tituloEleitor
                                        null, // zona
                                        null, // sessao
                                        null, // municipioUf
                                        null // inss
                        );

                        ICPBravoCertificate cert = gen.generate(manager, true);
                        mostraInformacoesCertificado(cert);
                } catch (Exception e) {
                        System.out.println("Gerando certificado X509v3: Falha " + e.getMessage());
                }
                cron.marcaTotal("Fim de teste de geração de X509 v3");
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 ps.: Algumas falhas nas verificações poderão ser observadas, por se tratar de um certificado de exemplo e não haver um servidor que comprove algumas verficações, como por exemplo CRL e cadeia de confiança.
 <pre class="brush: plain;">
Testando geração de certificados X509 v3
Gerando certificado X509v3 - ICPBrasil : OK
...
Fim de teste de geração de X509 v3 (2684 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaCertificadoX509v3Expirado()"><!-- --></A><H3>
testaCertificadoX509v3Expirado</H3>
<PRE>
public static void <B>testaCertificadoX509v3Expirado</B>()</PRE>
<DL>
<DD>Verifica um certificado expirado.
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaCertificadoX509v2()"><!-- --></A><H3>
testaCertificadoX509v2</H3>
<PRE>
public static void <B>testaCertificadoX509v2</B>()</PRE>
<DL>
<DD>Testa a geração e verificação de um certificado no padrão X509 v.2 (CRL).
 <p>
 O teste criará o certifcado e em seguida apresentará no system.out as
 interfaces deste certificado.
 </p>
 
 <pre class="brush: java;">
 public static void testaCertificadoX509v2() {
        cron.zera();
        System.out.println(&quot;Testando geração de certificados X509 v2&quot;);
        try {
                ICPBravoCRLGenerator genCRL = new ICPBravoCRLGenerator(manager, certRoot);
                genCRL.addCRLEntry(cert1.getSerialNumber(), new Date(), ICPBravoCRLGenerator.reason_unspecified);
                ICPBravoCRL crl = genCRL.generate(certRoot.getPrivateKey(), ICPBravoUtil.getDate(2009, 0, 23), ICPBravoUtil.getDate(2009, 1, 26));
 
                try {
                        crl.verify(cert1, certRoot);
                        System.out.println(&quot;O certificado não está revogado mais deveria estar&quot;);
                } catch (Exception e) {
                        System.out.println(&quot;O certificado está revogado &quot; + e.getMessage());
                }
 
                try {
                        crl.verify(cert2, certRoot);
                        System.out.println(&quot;O certificado não está revogado&quot;);
                } catch (Exception e) {
                        System.out.println(&quot;O certificado está revogado &quot; + e.getMessage() + &quot; mais não deveria estar&quot;);
                }
                System.out.println(&quot;X509 v2: OK&quot;);
 
                byte[] encoded = crl.getEncoded();
                ICPBravoCRL crl2 = new ICPBravoCRL(manager, encoded);
                if (crl.equals(crl2))
                        System.out.println(&quot;X509 v2 Encoded: OK&quot;);
                else
                        System.out.println(&quot;X509 v2 Encoded: Fail&quot;);
        } catch (Exception e) {
                System.out.println(&quot;X509 v2: Falha&quot;);
        }
        cron.marcaTotal(&quot;Fim de teste de geração de X509 v2&quot;);
 }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando geração de certificados X509 v2
O certificado está revogado Certificado revogado - DN:C=BR,O=ICP-Brasil,OU=Secretaria da Receita Federal fake - SRFf,OU=OU\=SRF e-CPF fake,CN=Pessoa 1:12345678901, DT:Fri Aug 28 09:46:50 BRT 2009
O certificado não está revogado
X509 v2: OK
X509 v2 Encoded: OK
Fim de teste de geração de X509 v2 (79 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="inicializaTeste()"><!-- --></A><H3>
inicializaTeste</H3>
<PRE>
public static void <B>inicializaTeste</B>()</PRE>
<DL>
<DD>Cria um novo manager de dispositivo (no caso é utilizado um para
 JavaKeyStore) e pega seu provider, que será utilizado no decorrer dos
 testes.
 
 <pre class="brush: java;">
public static void inicializaTeste() {
        cron.zera();
        try {
                System.out.println("Criando a infraestrutura necessária para os testes ...");

                manager = new TestManager("JKS", new ICPBravoProvider(), "1234".toCharArray());
                provider = manager.getProvider();
        } catch (Exception e) {
                e.printStackTrace();
        }
        cron.marcaTotal("... infraestrutura criada.");
}
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Criando a infraestrutura necessßria para os testes ...
ICPBravo v.X.XX - Uso restrito para: ...
ICPBravo v.X.XX - Uso restrito para: ...
... infraestrutura criada. (1181 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="criaCertificados()"><!-- --></A><H3>
criaCertificados</H3>
<PRE>
public static void <B>criaCertificados</B>()</PRE>
<DL>
<DD>O teste a seguir cria os certificados necessários para o teste
 <p>
 Serão criados 3 certificados, sendo um de raiz e dois de usuário.
 </p>
 
 <pre class="brush: java;">
        public static void criaCertificados() {
                cron.zera();
                try {
                        System.out.println("Criando certificados para os testes ...");

                        Date from = ICPBravoUtil.getDateNow();
                        Date to = ICPBravoUtil.getTo(ICPBravoUtil.MONTHS, 1);

                        certRoot = criaCertificadoRaiz(from, to);
                        cert1 = criaCertificado1(certRoot, from, to);
                        cert2 = criaCertificado2(certRoot, from, to);
                        cert3 = criaCertificado3(certRoot, from, to);
                        cert4 = criaCertificado4(certRoot, from, to);
                } catch (Exception e) {
                        e.printStackTrace();
                }
                cron.marcaTotal("... certificados de exemplo criados.");
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Criando certificados para os testes ...
Gerando certificado X509v3 - ICPBrasil (root 1): OK
Gerando certificado X509v3 - ICPBrasil (pessoa 1): OK
Gerando certificado X509v3 - ICPBrasil (pessoa 2): OK
... certificados de exemplo criados. (4043 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="criaCertificadoRaiz(java.util.Date, java.util.Date)"><!-- --></A><H3>
criaCertificadoRaiz</H3>
<PRE>
public static <A HREF="../../../../br/com/oaks/ICPBravo/certs/ICPBravoCertificate.html" title="class in br.com.oaks.ICPBravo.certs">ICPBravoCertificate</A> <B>criaCertificadoRaiz</B>(java.util.Date&nbsp;from,
                                                      java.util.Date&nbsp;to)
                                               throws java.security.NoSuchAlgorithmException,
                                                      <A HREF="../../../../br/com/oaks/ICPBravo/exceptions/NotSuportedAlgorithmException.html" title="class in br.com.oaks.ICPBravo.exceptions">NotSuportedAlgorithmException</A>,
                                                      java.io.IOException,
                                                      <A HREF="../../../../br/com/oaks/ICPBravo/exceptions/ErroKeystoreException.html" title="class in br.com.oaks.ICPBravo.exceptions">ErroKeystoreException</A>,
                                                      java.security.InvalidKeyException,
                                                      java.lang.IllegalStateException,
                                                      java.security.SignatureException,
                                                      java.security.KeyStoreException,
                                                      java.security.cert.CertificateException,
                                                      <A HREF="../../../../br/com/oaks/ICPBravo/exceptions/ChaveInvalidaException.html" title="class in br.com.oaks.ICPBravo.exceptions">ChaveInvalidaException</A>,
                                                      <A HREF="../../../../br/com/oaks/ICPBravo/exceptions/SigningException.html" title="class in br.com.oaks.ICPBravo.exceptions">SigningException</A>,
                                                      <A HREF="../../../../br/com/oaks/ICPBravo/exceptions/ErroIrrecuperavelEmChaveException.html" title="class in br.com.oaks.ICPBravo.exceptions">ErroIrrecuperavelEmChaveException</A>,
                                                      java.security.NoSuchProviderException,
                                                      java.security.InvalidAlgorithmParameterException,
                                                      java.security.spec.InvalidParameterSpecException,
                                                      <A HREF="../../../../br/com/oaks/ICPBravo/exceptions/ManagerNotInitialedException.html" title="class in br.com.oaks.ICPBravo.exceptions">ManagerNotInitialedException</A></PRE>
<DL>
<DD>Método chamado para criação de certificado Raiz.
 <pre class="brush: java;">
public static ICPBravoCertificate criaCertificadoRaiz(Date from, Date to) throws NoSuchAlgorithmException, NotSuportedAlgorithmException, IOException, ErroKeystoreException, InvalidKeyException, IllegalStateException, SignatureException, KeyStoreException, CertificateException, ChaveInvalidaException, SigningException, ErroIrrecuperavelEmChaveException, NoSuchProviderException, InvalidAlgorithmParameterException, InvalidParameterSpecException {
        ICPBravoCertificateGenerator gen = new ICPBravoCertificateGenerator(
                manager.getProvider(), 
                "Autoridade Certificadora Raiz Brasileira fake", 
                BigInteger.valueOf(1),
                "Autoridade Certificadora Raiz Brasileira fake", 
                null, 
                ICPBravoCertificateGenerator.getDefaultKeyUsageForCA(), 
                ICPBravoCertificateGenerator.getDefaultKeyPurposeForCA(),
                "http://acraiz.icpbrasil.gov.oaks.com.br/LCRacraiz.crl", 
                OIWObjectIdentifiers.OID_ICPBrasilDPC + ".0", 
                "http://acraiz.icpbrasil.gov.oaks.com.br/DPCacraiz.pdf",
                "Instituto Nacional de Tecnologia da Informacao fake - ITIf,L=Brasilia,S=DF", 
                from, to, 
                new SignatureAlgorithm(manager.getProvider(), new SHA1(manager.getProvider()), new RSA1024ECB(manager.getProvider())), 
                null);

        System.out.println("Gerando certificado X509v3 - ICPBrasil (root 1): OK");
        return gen.generate(manager, true);
}
 </pre>
<P>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE><A HREF="../../../../br/com/oaks/ICPBravo/exceptions/ManagerNotInitialedException.html" title="class in br.com.oaks.ICPBravo.exceptions">ManagerNotInitialedException</A></CODE>
<DD><CODE>java.security.NoSuchAlgorithmException</CODE>
<DD><CODE><A HREF="../../../../br/com/oaks/ICPBravo/exceptions/NotSuportedAlgorithmException.html" title="class in br.com.oaks.ICPBravo.exceptions">NotSuportedAlgorithmException</A></CODE>
<DD><CODE>java.io.IOException</CODE>
<DD><CODE><A HREF="../../../../br/com/oaks/ICPBravo/exceptions/ErroKeystoreException.html" title="class in br.com.oaks.ICPBravo.exceptions">ErroKeystoreException</A></CODE>
<DD><CODE>java.security.InvalidKeyException</CODE>
<DD><CODE>java.lang.IllegalStateException</CODE>
<DD><CODE>java.security.SignatureException</CODE>
<DD><CODE>java.security.KeyStoreException</CODE>
<DD><CODE>java.security.cert.CertificateException</CODE>
<DD><CODE><A HREF="../../../../br/com/oaks/ICPBravo/exceptions/ChaveInvalidaException.html" title="class in br.com.oaks.ICPBravo.exceptions">ChaveInvalidaException</A></CODE>
<DD><CODE><A HREF="../../../../br/com/oaks/ICPBravo/exceptions/SigningException.html" title="class in br.com.oaks.ICPBravo.exceptions">SigningException</A></CODE>
<DD><CODE><A HREF="../../../../br/com/oaks/ICPBravo/exceptions/ErroIrrecuperavelEmChaveException.html" title="class in br.com.oaks.ICPBravo.exceptions">ErroIrrecuperavelEmChaveException</A></CODE>
<DD><CODE>java.security.NoSuchProviderException</CODE>
<DD><CODE>java.security.InvalidAlgorithmParameterException</CODE>
<DD><CODE>java.security.spec.InvalidParameterSpecException</CODE></DL>
</DD>
</DL>
<HR>

<A NAME="testaAssinaturaDePDF()"><!-- --></A><H3>
testaAssinaturaDePDF</H3>
<PRE>
public static void <B>testaAssinaturaDePDF</B>()</PRE>
<DL>
<DD>O teste a seguir demonstrará uma característica de assinatura de PDF.
 Neste caso, será gerado um pdf assinado na saída que é resultado da assinatura do pdf de entrada.
 
 <pre class="brush: java;">
        public static void testaAssinaturaDePDF() {
                try {
                        cron.zera();

                        // Assinando um PDF
                        System.out.println("Testando assinatura de PDF");
                        PDFSignedData sd = new PDFSignedData(manager, "c:/temp/in.pdf");
                        sd.addSigner(cert1, new SignatureAlgorithm(cert1.getManager().getProvider(), new SHA1(cert1.getManager().getProvider()), new RSA(cert1.getManager().getProvider())), "ICPBravo", new Date(), "ICPBravo Test 1", "Brasil");
                sd.signToFile("c:/temp/out.pdf"); 

                // Abrindo o PDF assinado, verificando e adicionando uma nova assinatura
                PDFSignedData sd2 = new PDFSignedData(manager, "c:/temp/out.pdf");
                sd2.verify();
                        sd2.addSigner(cert2, new SignatureAlgorithm(cert2.getManager().getProvider(), new SHA1(cert2.getManager().getProvider()), new RSA(cert2.getManager().getProvider())), "ICPBravo", new Date(), "ICPBravo Test Contra-Assinatura", "Brasil");
                sd2.signToFile("c:/temp/out2.pdf"); 

                // Abrindo o novo PDF assinado e verificando suas assinaturas
                PDFSignedData sd3 = new PDFSignedData(manager, "c:/temp/out2.pdf");
                sd3.verify();
                        System.out.println("SignedData: OK");
                        List&lt;CMSSignerInformation&gt; signers = sd3.getSigners();
                        for (CMSSignerInformation signerInformation : signers) {
                                System.out.println("Signer: " + signerInformation.getCertificate().getName());
                                Pkcs9 pkcs9SignedAttributes = signerInformation.getSignedAttributes();
                                List&lt;SignatureAttribute&gt; signedAttributes = pkcs9SignedAttributes.getAttributes();
                                for (Attribute attribute : signedAttributes) {
                                        System.out.println(attribute.description() + ": " + attribute.toString());
                                }
                                Pkcs9 pkcs9UnsignedAttributes = signerInformation.getUnsignedAttributes();
                                List&lt;SignatureAttribute&gt; unsignedAttributes = pkcs9UnsignedAttributes.getAttributes();
                                for (Attribute attribute : unsignedAttributes) {
                                        System.out.println(attribute.description() + ": " + attribute.toString());
                                }

                                PdfSignerInformation pdfSignerInformation = sd3.getPdfSignerInformation(signerInformation.getCertificate());
                                System.out.println("PDF Date: "+pdfSignerInformation.getDate().toString());
                                System.out.println("PDF Reason: "+pdfSignerInformation.getReason());
                                System.out.println("PDF Location: "+pdfSignerInformation.getLocation());
                                System.out.println("PDF SignName: "+pdfSignerInformation.getSignName());
                        }

                        cron.marcaTotal("Fim de teste de assinatura de PDF");
                } catch (Exception e) {
                        System.out.println("SignedData: Falha " + e.getMessage());
                }
        }
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaSignedData()"><!-- --></A><H3>
testaSignedData</H3>
<PRE>
public static void <B>testaSignedData</B>()</PRE>
<DL>
<DD>O teste a seguir demonstrará um exemplo de CMS da API chamado de
 SignedData.
 <p>
 Neste teste, será criado um pacote CMS (PKCS#7) com uma assinatura, este
 envelope será codificado em um array de bytes, e em seguida será
 remontado, tendo sua assinatura verificada e seu conteúdo (PKCS#9)
 apresentado.
 </p>
 
 <pre class="brush: java;">
        public static void testaSignedData() {
                byte[] bts = "teste".getBytes();

                try {
                        cron.zera();
                        System.out.println("Testando geração de signedData");

                        Policy policy = new CMSPolicy();
                        policy.setTSTUrl("http://tsp.iaik.at/tsp/TspRequest");
                        SignedAttribute [] singedAttrs = new SignedAttribute [] {new CommitmentTypeIndicationAttribute(CommitmentTypeIndicationAttribute.proofOfCreation)};
                        policy.setSignedAttributes(singedAttrs);

                        CMSSignedData sd = new CMSSignedData(policy);
                        sd.setData(bts);
                        sd.setEncapsulate(true); // Attachment
                        sd.addSigner(cert1, new SignatureAlgorithm(cert1.getManager().getProvider(), new SHA1(cert1.getManager().getProvider()), new RSA(cert1.getManager().getProvider())));
                        byte[] sdPkcs7CMS = sd.getASN1Encoded();

                        sd = new CMSSignedData(sdPkcs7CMS);
                        sd.verify();

                        System.out.println("SignedData: OK");

                        List&lt;CMSSignerInformation&gt; signers = sd.getSigners();
                        for (CMSSignerInformation signerInformation : signers) {
                                System.out.println("Signer: " + signerInformation.getCertificate().getName());
                                Pkcs9 pkcs9SignedAttributes = signerInformation.getSignedAttributes();
                                List&lt;SignatureAttribute&gt; signedAttributes = pkcs9SignedAttributes.getAttributes();
                                for (Attribute attribute : signedAttributes) {
                                        System.out.println(attribute.description() + ": " + attribute.toString());
                                }
                                Pkcs9 pkcs9UnsignedAttributes = signerInformation.getUnsignedAttributes();
                                List&lt;SignatureAttribute&gt; unsignedAttributes = pkcs9UnsignedAttributes.getAttributes();
                                for (Attribute attribute : unsignedAttributes) {
                                        System.out.println(attribute.description() + ": " + attribute.toString());
                                }
                        }

                        // Variações das assinaturas ....
                        // Co-assinatura. Trata-se de uma forma de adicionar um signatário a uma assinatura pré-existente, independente da ordem da assinatura
                        CMSSignedData coAssinatura = new CMSSignedData(sdPkcs7CMS); // Constroi o pkcs#7 a partir de uma assinatura existente
                        coAssinatura.addSigner(cert2); // Adiciona um signatário ao pacote
                        byte[] sdCoAssinatura = coAssinatura.getASN1Encoded(); // Gera a nova assinatura

                        // Contra-assinatura. Trata-se de uma forma de assinatura onde um signatário assina um conteúdo assinado. A ordem das assinaturas são relevantes.
                        CMSSignedData contraAssinatura = new CMSSignedData(); // Cria um novo pacote pkcs#7
                        contraAssinatura.setData(sdCoAssinatura); // Indica qual é a assinatura que está sendo contra-assinada
                        contraAssinatura.addSigner(cert3); // Adiciona um signatário ao pacote
                        byte[] sdContraAssinatura = contraAssinatura.getASN1Encoded(); // Gera a nova assinatura

                        // Assinatura de lotes. Necessário para casos onde assina-se pastas, cujo seu conteúdo são documentos assinados.
                        CMSSignedData multiplasAssinatura = new CMSSignedData(); // Cria um novo pacote pkcs#7
                        MultipleContent contents = new MultipleContent(); // Cria um conteúdo que representa um conjunto de conteúdo
                        contents.addContent(new BytesContent(sdCoAssinatura)); // Adiciona uma assinatura pre-existente ao conteúdo
                        contents.addContent(new BytesContent(sdContraAssinatura));
                        contents.addContent(new BytesContent("Conteúdo".getBytes())); // Pode-se adicionar conteúdos que não são assinados
                        multiplasAssinatura.setData(contents);
                        multiplasAssinatura.addSigner(cert4); // Adiciona um signatário ao pacote
                        byte[] sdMultiplasAssinatura = multiplasAssinatura.getASN1Encoded(); // Gera a nova assinatura

                        // recupera os documentos de dentro da assinatura
                        multiplasAssinatura = new CMSSignedData(sdMultiplasAssinatura);
                        CMSContentCollection info = (CMSContentCollection) multiplasAssinatura.getDataAsContentInfo(); 
                        for (int a=0; a&lt;info.size(); a++) {
                                CMSContentInfo ct = info.getCMSContentInfo(a);
                                System.out.println(ct.getClass().toString());
                        }

                        cron.marcaTotal("Fim de teste de signedData");
                } catch (Exception e) {
                        System.out.println("SignedData: Falha " + e.getMessage());
                }
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando geração de signedData
SignedData: OK
Signer: Pessoa 1:12345678901
MessageDigest: Lm+bDViFtgEPkWd4dEVhf1U6c18=
ContentType: 1.2.840.113549.1.7.1
CommitmentTypeIndication: proofOfCreation, [1.2]
SigningTime: Fri Aug 28 15:25:05 BRT 2009
TimeStampToken: Fri Aug 28 15:25:07 BRT 2009, Signatário CN=IAIK-TSP DEMO Service, OU=Institute for Applied Information Processing and Communications, O=GRAZ UNIVERSITY OF TECHNOLOGY, L=Graz, ST=Styria, C=AT OK
class br.com.oaks.ICPBravo.cms.CMSSignedData
class br.com.oaks.ICPBravo.cms.CMSSignedData
class br.com.oaks.ICPBravo.cms.CMSData
Fim de teste de signedData (564 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaXmlDSig()"><!-- --></A><H3>
testaXmlDSig</H3>
<PRE>
public static void <B>testaXmlDSig</B>()</PRE>
<DL>
<DD>O teste a seguir demonstrará um exemplo de CMS da API chamado de
 SignedData.
 <p>
 Neste teste, será criado um pacote CMS (PKCS#7) com uma assinatura, este
 envelope será codificado em um array de bytes, e em seguida será
 remontado, tendo sua assinatura verificada e seu conteúdo (PKCS#9)
 apresentado.
 </p>
 
 <pre class="brush: java;">
        public static void testaXmlDSig() {
                byte[] bts = "teste".getBytes();

                try {
                        cron.zera();
                        System.out.println("Testando geração de XMLDSig");

                        Policy policy = new CMSPolicy();
                        policy.setTSTUrl("http://tsp.iaik.at/tsp/TspRequest");
                        SignedAttribute [] singedAttrs = new SignedAttribute [] {new CommitmentTypeIndicationAttribute(CommitmentTypeIndicationAttribute.proofOfCreation)};
                        policy.setSignedAttributes(singedAttrs);

                        CMSSignedData sd = new CMSSignedData(policy);
                        sd.setData(bts);
                        sd.setEncapsulate(true);
                        sd.addSigner(cert1, new SignatureAlgorithm(cert1.getManager().getProvider(), new SHA1(cert1.getManager().getProvider()), new RSA(cert1.getManager().getProvider())));

                        String xml = sd.getXMLEncoded();

                        sd = new CMSSignedData(new XMLDSigContent(xml));
                        sd.verify();

                        System.out.println("XMLDSig: OK");

                        List&lt;CMSSignerInformation&gt; signers = sd.getSigners();
                        for (CMSSignerInformation signerInformation : signers) {
                                System.out.println("Signer: " + signerInformation.getCertificate().getName());
                                Pkcs9 pkcs9SignedAttributes = signerInformation.getSignedAttributes();
                                List&lt;SignatureAttribute&gt; signedAttributes = pkcs9SignedAttributes.getAttributes();
                                for (SignatureAttribute attribute : signedAttributes) {
                                        System.out.println(attribute.description() + ": " + attribute.toString());
                                }
                                Pkcs9 pkcs9UnsignedAttributes = signerInformation.getUnsignedAttributes();
                                List&lt;SignatureAttribute&gt; unsignedAttributes = pkcs9UnsignedAttributes.getAttributes();
                                for (SignatureAttribute attribute : unsignedAttributes) {
                                        System.out.println(attribute.description() + ": " + attribute.toString());
                                }
                        }

                        cron.marcaTotal("Fim de teste de XMLDSig");
                } catch (Exception e) {
                        e.printStackTrace();
                        System.out.println("XMLDSig: Falha " + e.getMessage());
                }
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaEnvelopedData()"><!-- --></A><H3>
testaEnvelopedData</H3>
<PRE>
public static void <B>testaEnvelopedData</B>()</PRE>
<DL>
<DD>O teste a seguir demonstrará um exemplo de CMS da API chamado de
 EnvelopedData.
 <p>
 Neste teste será criado um envelopedData com um conteúdo criptogrado,
 endereçado a um certificados único. Assim como no teste de assinatura, o
 envelope é codificado e decodifcado e em seguida o conteúdo será
 decriptografado com a chave privada do certificado.
 </p>
 
 <pre class="brush: java;">
 public static void testaEnvelopedData() {
        byte[] bts = &quot;teste&quot;.getBytes();
        try {
                cron.zera();
                System.out.println(&quot;Testando geração de envelopedData&quot;);
 
                CMSEnvelopedData sd = new CMSEnvelopedData(provider, new AES128CBC(provider));
                sd.setData(bts);
                sd.addKeyTransRecipient(cert1);
                byte[] sdPkcs7CMS = sd.getASN1Encoded();
 
                sd = new CMSEnvelopedData(provider, sdPkcs7CMS);
                if (Arrays.equals(sd.getRecipient(cert1, cert1.getPrivateKey()), bts))
                        System.out.println(&quot;EnvelopedData: OK&quot;);
                else
                        System.out.println(&quot;EnvelopedData: Falha&quot;);
                cron.marcaTotal(&quot;Fim de teste de envelopedData&quot;);
        } catch (Exception e) {
                System.out.println(&quot;EnvelopedData: Falha &quot; + e.getMessage());
        }
 }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando geraþÒo de envelopedData
&lt;?xml version="1.0" encoding="ISO-8859-1" standalone="no"?&gt;
&lt;EnvelopedData&gt;
    &lt;EncryptedData xmlns="http://www.w3.org/2001/04/xmlenc#" Type="http://www.w3.org/2001/04/xmlenc#Element"&gt;
        &lt;EncryptionMethod/&gt;
        &lt;ds:KeyInfo xmlns:ds="http://www.w3.org/2000/09/xmldsig#"&gt;
&lt;ds:KeyValue&gt;
&lt;ds:RSAKeyValue&gt;
&lt;ds:Modulus&gt;
hpZHIfrR0nVBIg4A0kLlP8VDcjGBcyKC1XpL6y3VaPTZt8zhqtPTaaxRBlACmOvkwdZbSxZUrRdo
8LvISwhZ921jlmoNrSIDqCbhmv1jgLlmiiBE9EoKZeTFJrtE+11jyIKR6U0PXJ8hi/UvfshTjy4I
L39jM+fV4/vqaK09VaU=
&lt;/ds:Modulus&gt;
&lt;ds:Exponent&gt;AQAB&lt;/ds:Exponent&gt;
&lt;/ds:RSAKeyValue&gt;
&lt;/ds:KeyValue&gt;
&lt;/ds:KeyInfo&gt;
        &lt;CipherData&gt;
            &lt;CipherValue&gt;ow1zXHhMTUrGcbiC4WJ0kA==&lt;/CipherValue&gt;
            &lt;CipherReference/&gt;
        &lt;/CipherData&gt;
        &lt;EncryptionProperties/&gt;
    &lt;/EncryptedData&gt;
&lt;/EnvelopedData&gt;

EnvelopedData: OK
Fim de teste de envelopedData (2523 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaSignedAndEnvelopedData()"><!-- --></A><H3>
testaSignedAndEnvelopedData</H3>
<PRE>
public static void <B>testaSignedAndEnvelopedData</B>()</PRE>
<DL>
<DD>O teste a seguir demonstrará um exemplo de CMS da API chamado de
 SignedAndEnvelopedData.
 <p>
 Neste teste, será apresentado um envelope com conteúdo criptografado e
 assinado.
 </p>
 
 <pre class="brush: java;">
 public static void testaSignedAndEnvelopedData() {
        byte[] bts = &quot;teste&quot;.getBytes();
        try {
                cron.zera();
                System.out.println(&quot;Testando geração de signedAndEnvelopedData&quot;);
 
                List&lt;ICPBravoCertificate&gt; destinatarios = new ArrayList&lt;ICPBravoCertificate&gt;();
                destinatarios.add(cert2);
 
                SignedAndEnveloped sae = new SignedAndEnveloped(manager, cert1, destinatarios, new SignatureAlgorithm(cert1.getManager().getProvider(), new SHA1(cert1.getManager().getProvider()), new RSA(cert1
                                .getManager().getProvider())), new AES128CBC(provider), SignedAndEnveloped.SIGN_AND_ENVELOPED, new BytesContent(bts));
 
                String saeBase64 = new BytesContent(sae.getASN1Encoded()).getBase64Encoded();
 
                sae = new SignedAndEnveloped(manager, new Base64Content(saeBase64), cert2, cert2.getPrivateKey());
 
                if (Arrays.equals(sae.getDataBytes(), bts))
                        System.out.println(&quot;SignedAndEnvelopedData: OK&quot;);
                else
                        System.out.println(&quot;SignedAndEnvelopedData: Falha&quot;);
                cron.marcaTotal(&quot;Fim de teste de signedAndEnvelopedData&quot;);
        } catch (Exception e) {
                System.out.println(&quot;SignedAndEnvelopedData: Falha &quot; + e.getMessage());
        }
 }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando geração de signedAndEnvelopedData
SignedAndEnvelopedData: OK
Fim de teste de signedAndEnvelopedData (98 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaEnvelopesDigitais()"><!-- --></A><H3>
testaEnvelopesDigitais</H3>
<PRE>
public static void <B>testaEnvelopesDigitais</B>()</PRE>
<DL>
<DD>O teste a seguir demonstrará alguns exemplos de CMS da API, como
 SignedData, EnvelopedData e o SignedAndEnvelopedData.
 <p>
 No primeiro teste, será criado um pacote CMS (PKCS#7) com uma assinatura,
 este envelope será codificado em um array de bytes, e em seguida será
 remontado, tendo sua assinatura verificada e seu conteúdo (PKCS#9)
 apresentado.
 </p>
 <p>
 No segundo teste será criado um envelopedData com um conteúdo criptogrado,
 endereçado a um certificados único. Assim como no teste de assinatura, o
 envelope é codificado e decodifcado e em seguida o conteúdo será
 decriptografado com a chave privada do certificado.
 </p>
 <p>
 No último teste, será apresentado um envelope com conteúdo criptografado e
 assinado.
 </p>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaPBE()"><!-- --></A><H3>
testaPBE</H3>
<PRE>
public static void <B>testaPBE</B>()</PRE>
<DL>
<DD>Demonstra o uso da criptografia baseada em senhas.
 
 <pre class="brush: java;">
        public static void testaPBE() {
                cron.zera();
                System.out.println("Testando geração de PBE");
                try {
                        PBEAlgorithm pbe = new PBE_Sha1AndTripleDES112(provider);
                        char[] password = "password".toCharArray();

                        // Gera uma chave a partir de uma senha
                        Key sKey = pbe.generateKey(password);

                        byte[] input = "teste".getBytes();

                        // criptograda com a chave
                        byte[] out = pbe.crypt(input, sKey);

                        // decriptografa com a chave
                        byte [] dec = pbe.decrypt(out, sKey);

                        if (Arrays.equals(dec, input))
                                System.out.println("PBE: OK");
                        else
                                System.out.println("PBE: Falha");
                } catch (Exception e) {
                        System.out.println("PBE: Falha " + e.getMessage());
                }
                cron.marcaTotal("Fim de teste de PBE");
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando geração de PBE
PBE: OK
Fim de teste de PBE (102 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaShamirSecretSharing()"><!-- --></A><H3>
testaShamirSecretSharing</H3>
<PRE>
public static void <B>testaShamirSecretSharing</B>()</PRE>
<DL>
<DD>Demonstra o uso do algoritmo ShamirSecretSharing.
 <p>
 Trata-se de um algoritmo que permite criptografar um conteúdo, onde m
 entre n pessoas podem decriptografar seu conteúdo.
 </p>
 <p>
 O teste criptografará um conteúdo para 10 pessoas, sendo que no mínimo 3
 poderão abrir.
 </p>
 <p>
 Em seguida tentará abrir com apenas 2 senhas, o que deverá resultar em um
 erro.
 <p>
 <p>
 O próximo passo será tentar abrir com 3 senhas, onde o conteúdo poderá ser
 verficado contra o original.
 </p>
 
 <pre class="brush: java;">
 public static void testaShamirSecretSharing() {
        cron.zera();
        System.out.println(&quot;Testando geração de Shamir Secret Sharing&quot;);
        try {
                ShamirSecretSharing sss = new ShamirSecretSharing(SecureRandom.getInstance(&quot;SHA1PRNG&quot;));
                byte[] secret = &quot;segredo&quot;.getBytes();
                ArrayList&lt;byte[]&gt; shares = new ArrayList&lt;byte[]&gt;();
                System.out.println(&quot;Shamir Secret Sharing: testando com 10 shares e quorum de 3&quot;);
                sss.shareSecret(secret, 3, 10, shares, true);
                ArrayList&lt;byte[]&gt; knownShares = new ArrayList&lt;byte[]&gt;();
                knownShares.add(shares.get(0));
                knownShares.add(shares.get(1));
                try {
                        if (Arrays.equals(sss.revealSecret(knownShares), secret))
                                System.out.println(&quot;Shamir Secret Sharing: Falha - Segredo revelado quando não deveria&quot;);
                        else
                                System.out.println(&quot;Shamir Secret Sharing: OK - Segredo não revelado com apenas 2 shares&quot;);
                } catch (SecretRevelationException ex) {
                        System.out.println(&quot;Shamir Secret Sharing: OK - Segredo não revelado com apenas 2 shares&quot;);
                }
 
                knownShares.add(shares.get(2));
                try {
                        if (Arrays.equals(sss.revealSecret(knownShares), secret))
                                System.out.println(&quot;Shamir Secret Sharing: OK - Segredo revelado com 3 shares&quot;);
                        else
                                System.out.println(&quot;Shamir Secret Sharing: Falha - Segredo não revelado quando deveria&quot;);
                } catch (SecretRevelationException ex) {
                        System.out.println(&quot;Shamir Secret Sharing: Falha - Segredo não revelado quando deveria&quot;);
                }
        } catch (Exception e) {
                System.out.println(&quot;Shamir Secret Sharing: Falha &quot; + e.getMessage());
        }
        cron.marcaTotal(&quot;Fim de teste de Shamir Secret Sharing&quot;);
 }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando geração de Shamir Secret Sharing
Shamir Secret Sharing: testando com 10 shares e quorum de 3
Shamir Secret Sharing: OK - Segredo não revelado com apenas 2 shares
Shamir Secret Sharing: OK - Segredo revelado com 3 shares
Fim de teste de Shamir Secret Sharing (19 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaPKCS11()"><!-- --></A><H3>
testaPKCS11</H3>
<PRE>
public static void <B>testaPKCS11</B>()</PRE>
<DL>
<DD>Demonstra a relação com os dispositivos criptográficos do tipo PKCS#11 <br>
 O código a seguir abrirá um PKCS#11 e mostrará todos os certificados
 dentro do dispositivo.
 
 <pre class="brush: java;">
        public static void testaPKCS11() {
                cron.zera();
                System.out.println("Testando PKCS11");
                try {
                        ICPBravoManager mgr;

                        mgr = new PKCS11Manager();
                        mgr.reload();
                        Vector&lt;ICPBravoCertificate&gt; certs = mgr.getCertificates();
                        for (ICPBravoCertificate bravoCertificate : certs) {
                                System.out.println(bravoCertificate.getName());
                        }
                        System.out.println("PKCS#11: OK");
                } catch (Exception e) {
                        System.out.println("PKCS#11: Falha " + e.getMessage());
                }
                cron.marcaTotal("Fim de teste de PKCS11");
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando PKCS11
UBIRATAN DE ALMEIDA ELIAS:46133011149
PKCS#11: OK
Fim de teste de PKCS11 (278 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaPKCS12()"><!-- --></A><H3>
testaPKCS12</H3>
<PRE>
public static void <B>testaPKCS12</B>()</PRE>
<DL>
<DD>Demonstra a relação com os dispositivos criptográficos do tipo PKCS#12. <br>
 <br>O teste abaixo fará a criação de dois certificados dentro de um repositório PKCS#12 (selecionado por um dialog box) e, em seguida, abrirá o repositório e apresentará os certificados no repositório.
 
 <pre class="brush: java;">
        public static void testaPKCS12() {
                cron.zera();
                System.out.println("Testando PKCS12");
                try {
                        Date from = ICPBravoUtil.getDateNow();
                        Date to = ICPBravoUtil.getTo(ICPBravoUtil.MONTHS, 1);

                        ICPBravoManager mgr = new PKCS12Manager();
                        ICPBravoCertificateGenerator gen = new ICPBravoCertificateGenerator(mgr.getProvider(), aliasRoot, BigInteger.valueOf(1),
                                        aliasRoot, 
                                        null, 
                                        ICPBravoCertificateGenerator.getDefaultKeyUsageForFinal(), 
                                        ICPBravoCertificateGenerator.getDefaultKeyPurposeForFinal(),
                                        null, null, null,
                                        "Instituto Nacional de Tecnologia da Informacao fake - ITIf,L=Brasilia,S=DF", null, null, 
                                        from, to, 
                                        new SignatureAlgorithm(mgr.getProvider(), new SHA1(mgr.getProvider()), new RSA1024ECB(mgr.getProvider())), 
                                        null);
                        ICPBravoCertificate root = gen.generate(mgr, true);

                        gen = new ICPBravoCertificateGenerator(mgr.getProvider(), aliasServidor, BigInteger.valueOf(4),
                                        "Certificado de Servidor", root, false, ICPBravoCertificateGenerator.getDefaultKeyUsageForFinal(), 
                                        ICPBravoCertificateGenerator.getDefaultKeyPurposeForFinal(),
                                        null, null, null,
                                        "Instituto Nacional de Tecnologia da Informacao fake - ITIf,L=Brasilia,S=DF", null, null, 
                                        from, to, 
                                        new SignatureAlgorithm(mgr.getProvider(), new SHA1(mgr.getProvider()), new RSA1024ECB(mgr.getProvider())), 
                                        null);
                        gen.generate(mgr, true);
                        mgr.saveTofile();

                        mgr = new PKCS12Manager();
                        mgr.reload();
                        Vector&lt;ICPBravoCertificate&gt; certs = mgr.getCertificates();
                        for (ICPBravoCertificate bravoCertificate : certs) {
                                System.out.println(bravoCertificate.getName());
                        }
                        System.out.println("PKCS#12: OK");
                } catch (Exception e) {
                        System.out.println("PKCS#12: Falha " + e.getMessage());
                }
                cron.marcaTotal("Fim de teste de PKCS12");
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando PKCS12
Certificado Raiz
Certificado de Servidor
PKCS#12: OK
Fim de teste de PKCS12 (25595 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaLDAP()"><!-- --></A><H3>
testaLDAP</H3>
<PRE>
public static void <B>testaLDAP</B>()</PRE>
<DL>
<DD>Executa um teste das capacidades de integração da API com LDAP.
 <p>
 Primeiramente, o teste grava um certificado em um diretório LDAP,
 depois recupera-o pelo DN do registro, e depois pelo número de série
 do certificado e pelo nome do emissor do certificado.
 <p>
 Depois, o teste acessa um diretório LDAP público e faz a leitura de
 um certificado baseado no email do titular. 
 
 <pre class="brush: java;">
                public static void testaLDAP() {
                        cron.zera();
                        System.out.println("Testando LDAP");
                        try {

                                String host = "ldap://piv.cognitio.com.br:389/dc=oaktech,dc=com,dc=br";
                                String name = "uid=john,ou=people";
                                String credentials = "cn=admin,dc=oaktech,dc=com,dc=br";
                                String password = "ldappass";

                                List&lt;ICPBravoCertificate&gt; retrievedCerts;
                                ICPBravoCertificate retrievedCert;

                                LdapManager manager = new LdapManager(host, new LdapDNFilter(name), credentials, password);
                                manager.removeCertificates(name);
                                manager.addCertificate(name, cert1);
                                System.out.println("Certificado armazenado no registro \"" + name + "\".");

                                manager.reload();
                                retrievedCerts = manager.getCertificates();
                                Assert.assertTrue("Não foi possível recuperar o registro pelo DN", retrievedCerts != null);
                                Assert.assertTrue("Mais de um certificado encontrado pelo DN", retrievedCerts.size() == 1);
                                retrievedCert = retrievedCerts.get(0);
                                Assert.assertTrue("O certificado recuperado não confere com o gravado", retrievedCert.equals(cert1));
                                System.out.println("Certificado recuperado com sucesso por nome de registro (LDAP DN).");

                                manager.setFilter(new LdapSerialNumberFilter(null, retrievedCert.getSerialNumber(), retrievedCert.getIssuerName()));
                                manager.reload();
                                retrievedCerts = manager.getCertificates();
                                Assert.assertTrue("Não foi possível recuperar o registro pelo issuer name e serial number", retrievedCerts != null);
                                Assert.assertTrue("Mais de um certificado foi encontrado pelo issuer name e serial number", retrievedCerts.size() == 1);
                                retrievedCert = retrievedCerts.get(0);
                                Assert.assertTrue("O certificado recuperado não confere com o gravado", retrievedCert.equals(cert1));
                                System.out.println("Certificado recuperado pelo isser name e serial number.");

                                manager.removeCertificate(name, cert1);
                                manager.setFilter(new LdapDNFilter(name));
                                manager.reload();
                                retrievedCerts = manager.getCertificates();
                                Assert.assertTrue("O certificado não pôde ser excluído do diretório", retrievedCerts == null || retrievedCerts.size() == 0);
                                System.out.println("Certificado excluído do diretório.");

                                host = "ldap://directory.certisign.com.br";
                                String mail = "pmattos@certisign.com.br";
                                manager = new LdapManager(host, new LdapEmailFilter(null, mail));
                                manager.reload();
                                for (ICPBravoCertificate bravoCertificate : manager.getCertificates()) {
                                        System.out.println("Certificado encontrado em no diretório \"" + host + "\" para o email \"" + mail + "\": " + bravoCertificate.getName());
                                }

                                System.out.println("LDAP: OK");
                        } catch (Exception e) {
                                System.out.println("LDAP: Falha " + e.getMessage());
                        }
                        cron.marcaTotal("Fim de teste de LDAP");
                }
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaSMIME()"><!-- --></A><H3>
testaSMIME</H3>
<PRE>
public static void <B>testaSMIME</B>()</PRE>
<DL>
<DD>Apresenta um envio de email assinado. <br>
 O teste a seguir criará um email com um conteúdo e adicionará uma
 assinatura para o conteúdo. <br>
 No momento em que rodar, abrirá uma janela solicitando a senha para acesso
 ao provedor de SMTP.
 
 <pre class="brush: java;">
 private static void testaSMIME() {
        cron.zera();
        System.out.println(&quot;Testando S/MIME&quot;);
        try {
                String senhaEmail = &quot;&quot;;
                char[] senhaEmailBt = ICPBravoManager.getPIN(&quot;Informe a senha do provedor de SMTP&quot;);
                for (char c : senhaEmailBt) {
                        senhaEmail += c;
                }
 
                ICPBravoMailServer smtpServer = new SMTPMailServer(&quot;mail.oaktech.com.br&quot;, &quot;UbiratanElias@oak&quot;, senhaEmail);
                ICPBravoMailMessage message = new ICPBravoMailMessage(smtpServer, &quot;UbiratanElias@lanchecerto.com.br&quot;, &quot;Teste de email&quot;);
                message.setSender(&quot;UbiratanElias@oaktech.com.br&quot;);
                MimeBodyPart part = message.addMailPart(new DataSourceMailPart(new TextEncodedDataSource(&quot;ttt&quot;, &quot;Teste&quot;)));
 
                message.addMailPart(new SignatureMailPart(manager, cert1, new SignatureAlgorithm(cert1.getManager().getProvider(), new SHA1(cert1.getManager().getProvider()), new RSA(cert1.getManager()
                                .getProvider())), part));
 
                message.sendMessage();
                System.out.println(&quot;S/MIME: OK&quot;);
        } catch (Exception e) {
                System.out.println(&quot;S/MIME: Falha &quot; + e.getMessage());
        }
        cron.marcaTotal(&quot;Fim de teste de S/MIME&quot;);
 }
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaDiffieHellman()"><!-- --></A><H3>
testaDiffieHellman</H3>
<PRE>
public static void <B>testaDiffieHellman</B>()</PRE>
<DL>
<DD>Testa o uso do algoritmo DiffieHelman para a troca de chave.
 
 <pre class="brush: java;">
 public static void testaDiffieHellman() {
        try {
                cron.zera();
                byte[] bts = &quot;mensagem&quot;.getBytes();
                DiffieHellman source = new DiffieHellman(provider);
                DiffieHellman target = new DiffieHellman(provider);
                SymmetricAlgorithm sym = new AES128ECB(provider);
 
                KeyPair sourceKeyPair = source.generateKeyPair();
                KeyPair targetKeyPair = target.generateKeyPair(sourceKeyPair.getPublic());
                cron.marcaParcial(&quot;DiffieHelmman: chave estabelecida dos dois lados&quot;);
 
                SecretKey sourceSecretKey = source.generateSecretKey(sourceKeyPair.getPrivate(), targetKeyPair.getPublic(), sym);
                byte[] crypt = sym.crypt(bts, sourceSecretKey);
                cron.marcaParcial(&quot;DiffieHelmman: criptografado&quot;);
 
                SecretKey targetSecretKey = source.generateSecretKey(targetKeyPair.getPrivate(), sourceKeyPair.getPublic(), sym);
                byte[] ret = sym.decrypt(crypt, targetSecretKey);
                cron.marcaParcial(&quot;DiffieHelmman: decriptografado&quot;);
 
                if (Arrays.equals(bts, ret)) {
                        cron.marcaTotal(&quot;DiffieHelmman: OK&quot;);
                } else {
                        System.out.println(&quot;DiffieHelmman: Falha&quot;);
                }
        } catch (Exception ex) {
                System.out.println(&quot;testaDiffieHellman: Falha &quot; + ex.getMessage());
        }
 }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
DiffieHelmman: chave estabelecida dos dois lados (28793 ms)
DiffieHelmman: criptografado (97 ms)
DiffieHelmman: decriptografado (92 ms)
DiffieHelmman: OK (28983 ms)
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaSSL()"><!-- --></A><H3>
testaSSL</H3>
<PRE>
public static void <B>testaSSL</B>()</PRE>
<DL>
<DD>Este exemplo cria um servidor SSL/TSL que aguarda uma conexão do cliente
 com certificado. O Servidor devolve os mesmos dados recebidos prefixados
 por uma string "Cliente Enviou : ". Para informar que a comunicação chegou
 ao fim o cliente deve enviar o caracter '!'.
 
 <pre class="brush: java;">
protected static final String arqRoot = "root.jks";
protected static final String arqServer = "server.jks";
protected static final String arqCliente = "cliente.jks";

protected static char [] senhaRoot = "1234".toCharArray();
protected static char [] senhaServidor = "1234".toCharArray();
protected static char [] senhaCliente = "1234".toCharArray();

protected static final String aliasRoot = "Certificado Raiz";
protected static final String aliasServidor = "Certificado de Servidor";
protected static final String aliasCliente = "Certificado de Cliente";

public static final int sslPort = 9021;
public static final String host = "localhost";

public static void testaSSL() {
        cron.zera();
        Security.addProvider(new ICPBravoProvider());
        System.out.println("Testando SSL");
        try {
                SSLServerWithClientAuthId server = new SSLServerWithClientAuthId(sslPort,true);
                Thread t = new Thread(server);
                t.setName("TSL_Test");
                t.setDaemon(false);
                t.start();
                Thread.sleep(100);
                SSLClientImpl client = new SSLClientImpl(sslPort);
                client.doProtocol();
                Thread.sleep(100);
                if (t.isAlive())
                        t.interrupt();
                Thread.sleep(100);
                System.out.println("SSL: OK");
        } catch (Exception e) {
                System.out.println("SSL: Falha " + e.getMessage());
                e.printStackTrace();
        }
        cron.marcaTotal("Fim de teste de SSL");
}

public static class SSLServerWithClientAuthId extends SSLServer {
        public SSLServerWithClientAuthId(int port, boolean needClientAuth) throws KeyStoreException, NoSuchAlgorithmException {
                super(port, needClientAuth, new JKSManager(arqServer, senhaServidor), new JKSManager(arqRoot, senhaRoot), SSLContext.getInstance("TLS", provider), senhaServidor);
        }

        protected void doProtocol(Socket sSock) throws IOException {
                System.out.println("session started.");
                InputStream in = sSock.getInputStream();
                OutputStream out = sSock.getOutputStream();
                out.write("Cliente Enviou : ".getBytes());
                int ch = 0;
                while ((ch = in.read()) != '!') {
                        out.write(ch);
                }

                out.write('!');

                sSock.close();
                try {
                        Thread.sleep(200);
                } catch (InterruptedException e) {
                }
                System.out.println("session closed.");
        }
}

public static class SSLClientImpl extends SSLClient {
        public SSLClientImpl(int port) throws Exception {
                super(host, port, new JKSManager(arqCliente, senhaCliente), new JKSManager(arqRoot, senhaRoot), SSLContext.getInstance("TLS", provider), senhaCliente);
        }

        protected void doProtocol(Socket sSock) throws IOException {
                OutputStream out = sSock.getOutputStream();
                InputStream in = sSock.getInputStream();

                out.write("Dados Cliente".getBytes());
                out.write('!');

                int ch = 0;
                while ((ch = in.read()) != '!') {
                        System.out.print((char) ch);
                }
                System.out.println((char) ch);
        }
}
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="testaSSLCriaCertificados()"><!-- --></A><H3>
testaSSLCriaCertificados</H3>
<PRE>
public static void <B>testaSSLCriaCertificados</B>()
                                     throws java.lang.Exception</PRE>
<DL>
<DD>Criar certificados e keystore para o teste de SSL.
 
 <pre class="brush: java;">
        public static void testaSSLCriaCertificados() throws Exception {
                ICPBravoManager mgr;
                ICPBravoCertificateGenerator gen;

                Date from = ICPBravoUtil.getDateNow();
                Date to = ICPBravoUtil.getTo(ICPBravoUtil.MONTHS, 1);

                // trust store for client
                mgr = new JKSManager(arqRoot, senhaRoot);
                gen = new ICPBravoCertificateGenerator(mgr.getProvider(), aliasRoot, BigInteger.valueOf(1),
                                aliasRoot, 
                                null, 
                                ICPBravoCertificateGenerator.getDefaultKeyUsageForFinal(), 
                                ICPBravoCertificateGenerator.getDefaultKeyPurposeForFinal(),
                                null, null, null,
                                "Instituto Nacional de Tecnologia da Informacao fake - ITIf,L=Brasilia,S=DF", null, null, 
                                from, to, 
                                new SignatureAlgorithm(manager.getProvider(), new SHA1(manager.getProvider()), new RSA1024ECB(manager.getProvider())), 
                                null);
                ICPBravoCertificate root = gen.generate(mgr, true);
                mgr.saveTofile();

                // server credentials
                mgr = new JKSManager(arqServer, senhaServidor);
                gen = new ICPBravoCertificateGenerator(mgr.getProvider(), aliasServidor, BigInteger.valueOf(4),
                                "Certificado de Servidor", root, false, ICPBravoCertificateGenerator.getDefaultKeyUsageForFinal(), 
                                ICPBravoCertificateGenerator.getDefaultKeyPurposeForFinal(),
                                null, null, null,
                                "Instituto Nacional de Tecnologia da Informacao fake - ITIf,L=Brasilia,S=DF", null, null, 
                                from, to, 
                                new SignatureAlgorithm(manager.getProvider(), new SHA1(manager.getProvider()), new RSA1024ECB(manager.getProvider())), 
                                null);
                gen.generate(mgr, true);
                mgr.saveTofile();

                // client credentials
                mgr = new JKSManager(arqCliente, senhaCliente);
                gen = new ICPBravoCertificateGenerator(mgr.getProvider(), aliasCliente, BigInteger.valueOf(5),
                                "Certificado de Cliente", root, false, ICPBravoCertificateGenerator.getDefaultKeyUsageForFinal(), 
                                ICPBravoCertificateGenerator.getDefaultKeyPurposeForFinal(),
                                null, null, null,
                                "Instituto Nacional de Tecnologia da Informacao fake - ITIf,L=Brasilia,S=DF", null, null, 
                                from, to, 
                                new SignatureAlgorithm(manager.getProvider(), new SHA1(manager.getProvider()), new RSA1024ECB(manager.getProvider())), 
                                null);
                gen.generate(mgr, true);
                mgr.saveTofile();
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
 </pre>
<P>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE>java.lang.Exception</CODE></DL>
</DD>
</DL>
<HR>

<A NAME="testaECDH()"><!-- --></A><H3>
testaECDH</H3>
<PRE>
public static void <B>testaECDH</B>()</PRE>
<DL>
<DD>Demonstra o uso do algoritmo ECDH (Elliptic Curve Diffie-Hellman) para
 troca de chaves.
 <p>
 <pre class="brush: java;">
        public static void testaECDH() {

                try {
                        DiffieHellmanEC ec = new DiffieHellmanEC(provider);
                        KeyPair sourceKeyPair = ec.generateKeyPair(); 
                        KeyPair targetKeyPair = ec.generateKeyPair(sourceKeyPair.getPublic());
                        byte[] sourceSecret = ec.generateSecretKey(sourceKeyPair.getPrivate(), targetKeyPair.getPublic());
                        byte[] targetSecret = ec.generateSecretKey(targetKeyPair.getPrivate(), sourceKeyPair.getPublic());

                        if (Utils.arraysEquals(sourceSecret, targetSecret)) {
                                System.out.println("ECDH KeyAgreement: OK");
                        } else {
                                System.out.println("ECDH KeyAgreement: Falha");
                        }
                } catch (Exception e) {
                        System.out.println("ECDH KeyAgreement: Falha " + e.getMessage());
                }
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
ECDH KeyAgreement: OK
 </pre>
<P>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="changeTrustedChain()"><!-- --></A><H3>
changeTrustedChain</H3>
<PRE>
public static void <B>changeTrustedChain</B>()
                               throws java.lang.Exception</PRE>
<DL>
<DD>Demonstração de alteração da cadeia de confiança ao testar se um certificado é confiável.
 <p>
 <pre class="brush: java;">
        public static void changeTrustedChain() throws Exception {
                // Cria um repositório de trusteds (no caso abaixo, no arquivo /temp/trusted.jks com o respectivo pin 1234)
                JKSManager trustedChain = new JKSManager("/temp/trusted.jks", "1234".toCharArray());
                trustedChain.reload();

                // Importa um certificado .CER para dentro da cadeia.
                // Ps. esta operação precisa ser feita apenas uma única vez, pois após feita, o certificado já foi importado para o JKS
                Content certBts = new FileContent("/temp/AC OAK.cer");
                ICPBravoCertificate certOak = new ICPBravoCertificate("Raiz OAK", certBts.getContent());
                trustedChain.addCertificate("Raiz OAK", certOak);

                // Salva a cadeia no arquivo
                trustedChain.saveTofile();

                trustedChain.reload();

                // Mostrar os certificados dentro da cadeia de confiáveis
                for (ICPBravoCertificate c : trustedChain.getCertificates()) {
                        System.out.println(c.getName());
                }

                // Mudar a cadeia de confiança default
                ICPBravoManager.setTrustedManager(trustedChain);

                // A partir deste ponto, todos os certificados onde for testado o método isTrusted() ou tryTrustedValidate() já farão sua verificação dentro desta nova cadeia
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
OAK Solucoes Empresariais em Informatica LTDA
 </pre>
<P>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE>java.lang.Exception</CODE></DL>
</DD>
</DL>
<HR>

<A NAME="autenticaUsuario(java.lang.String, java.lang.String)"><!-- --></A><H3>
autenticaUsuario</H3>
<PRE>
public static java.lang.String <B>autenticaUsuario</B>(java.lang.String&nbsp;challenge,
                                                java.lang.String&nbsp;pkcs7)
                                         throws java.lang.Exception</PRE>
<DL>
<DD>O seguinte exemplo busca orientar a construção do código de servidor para a validação de uma assinatura em ambiente
 de autenticação de usuário com certificado digital.
 
 O trecho de código para realizar tal operação é:
 <pre class="brush: java;">
        public static String autenticaUsuario(String challenge, String pkcs7) throws Exception {
                // Reabre o pacote de assinatura
                CMSSignedData sign = new CMSSignedData(new Base64Content(ICPBravoUtil.readFromUrlAndBase64(pkcs7)));

                // Verifica se as assinaturas correspondem ao conteúdo assinado
                sign.verify();

                // Recupera o conteúdo assinado
                String signChallenge = sign.getData().getString(); // Aqui teremos o conteúdo que foi assinado

                // Se o conteúdo assinado corresponde ao que se desejava que fosse assinado
                if (challenge.equals(signChallenge)) { // É sinal que o nosso desafio foi respondido
                        // Recupera a primeira informação de assinatura. Neste ponto fazemos um
                        // pré-julgamento que o nosso pacote de resposta contém como primeira assinatura
                        // a assinatura que nos interessa, coisa que em ambiente de challenge-response pode ser
                        // considerado como uma afirmação verdadeira.
                        CMSSignerInformation signatario = sign.getSigners().get(0);

                        // Recupera o certificado do signatário
                        ICPBravoCertificate certificadoSignatario = signatario.getCertificate();

                        // Recupera nossa lista de certificados confiáveis (vide changeTrustedChain()) 
                        JKSManager trustedChain = new JKSManager("/temp/trusted.jks", "1234".toCharArray());
                        trustedChain.reload();

                        try {
                                // Verifica se o certificado é confiável em nossa cadeia
                                certificadoSignatario.tryTrustedValidate(trustedChain);

                                // Em alguns casos pode ser interessante fazer alguns testes no certificado do usuário,
                                // como se está ou não válido ou revogado, ou outro dentre os inúmeros testes de certificado.
                                // (vide testes de certificado em mostraInformacoesCertificado())

                                // Se chegou até aqui é porque o conteúdo (challenge) foi assinado corretamente e 
                                // o certificado foi emitido por uma raiz na qual confiamos.
                                // Neste caso podemos entender que esta raiz só poderia emitir um certificado com 
                                // um determinado número de CPF ao real portador daquele CPF, ou seja, nós confiamos
                                // naquela ICP.
                                // Podemos então devolver ao nosso sistema este número de CPF indicando que a pessoa
                                // que está tentando o login é o real portador daquele número de CPF, onde basta recuperar
                                // em nossa base de dados o registro de usuário correspondente aquele número de CPF (tarefa esta
                                // que foje ao escopo desta nossa demostração).
                                return certificadoSignatario.getDocumentNumber();
                        } catch (Exception e) {
                                throw new Exception ("O certificado não foi emitido por uma raiz que confiamos.");
                        }
                } else 
                        throw new Exception ("O conteúdo assinado não confere com o desafio lançado.");
        }
 </pre>
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>challenge</CODE> - O desafio que foi enviado para o usuário, para que este pudesse assiná-lo.<DD><CODE>pkcs7</CODE> - A resposta ao desafio, ou seja, a assinatura deste desafio. Esta assinatura está em 
 formato Base64 de forma a representar um conteúdo adquirido em ambiente que, para este caso, normalmente é Web.
<DT><B>Returns:</B><DD>
<DT><B>Throws:</B>
<DD><CODE>java.lang.Exception</CODE> - Caso o desafio não tenha sido concluído.</DL>
</DD>
</DL>
<HR>

<A NAME="testaCertificadoPEM()"><!-- --></A><H3>
testaCertificadoPEM</H3>
<PRE>
public static void <B>testaCertificadoPEM</B>()
                                throws java.lang.Exception</PRE>
<DL>
<DD>Teste que permite a leitura e criação de certificados a partir de PEM Encoded.
 <p>
 <pre class="brush: java;">
        public static void testaCertificadoPEM() throws Exception {
                cron.zera();
                System.out.println("Testando Certificados em PEM");
                try {
                        String pem = cert1.getPEM();
                        System.out.println(pem);
                        ICPBravoCertificate c = ICPBravoCertificate.CreateFromPEM(pem, manager, "test");
                        c.verify(c.getPublicKey());
                        System.out.println("Certificados em PEM: OK");
                } catch (Exception e) {
                        System.out.println("Certificados em PEM: Falha " + e.getMessage());
                }
                cron.marcaTotal("Fim de teste de Certificados em PEM");
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando Certificados em PEM
-----BEGIN CERTIFICATE-----
MIIEljCCA/+gAwIBAgIBAjANBgkqhkiG9w0BAQUFADCBvzELMAkGA1UEBhMCQlIxEzARBgNVBAoT
CklDUC1CcmFzaWwxCzAJBgNVBAgTAkRGMREwDwYDVQQHEwhCcmFzaWxpYTFDMEEGA1UECxM6SW5z
dGl0dXRvIE5hY2lvbmFsIGRlIFRlY25vbG9naWEgZGEgSW5mb3JtYWNhbyBmYWtlIC0gSVRJZjE2
MDQGA1UEAxMtQXV0b3JpZGFkZSBDZXJ0aWZpY2Fkb3JhIFJhaXogQnJhc2lsZWlyYSBmYWtlMB4X
DTA5MDkyNTE0MTUzM1oXDTA5MTAyNTEzMTUzM1owgZExHTAbBgNVBAMMFFBlc3NvYSAxOjEyMzQ1
Njc4OTAxMRowGAYDVQQLDBFPVT1TUkYgZS1DUEYgZmFrZTEyMDAGA1UECwwpU2VjcmV0YXJpYSBk
YSBSZWNlaXRhIEZlZGVyYWwgZmFrZSAtIFNSRmYxEzARBgNVBAoMCklDUC1CcmFzaWwxCzAJBgNV
BAYTAkJSMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCEqz25Mw6klUnJ6ui5g/B0HLvPVTUj
5SgR12bQrgWeHxEPRPEDcxa44QEa3ZNrJ74rs6+ITapxYDTiKaxuG3B2PYVLVlaBgcXZ3lTfjeGL
iQAG05eZIBoKDVDmaOkvUdAwBMW0IMXl/3vME8X7rUaURnPPZkxkg9hCvMnbq4HZvQIDAQABo4IB
zDCCAcgwXwYDVR0gAQH/BFUwUzBRBgZgTAECAwowRzBFBggrBgEFBQcCARY5aHR0cDovL3d3dy5j
ZXJ0aWZpY2Fkb2RpZ2l0YWwub2Frcy5jb20uYnIvcmVwb3NpdG9yaW8vZHBjMFsGA1UdHwEB/wRR
ME8wTaBLoEmGR2h0dHA6Ly93d3cuY2VydGlmaWNhZG9kaWdpdGFsLm9ha3MuY29tLmJyL3JlcG9z
aXRvcmlvL2xjci9TZXJhc2FTUkYuY3JsMAwGA1UdEwEB/wQCMAAwDgYDVR0PAQH/BAQDAgXgMDQG
A1UdJQEB/wQqMCgGCCsGAQUFBwMCBggrBgEFBQcDBAYIKwYBBQUHAwMGCCsGAQUFBwMIMIGzBgNV
HREEgaswgaiBF3Blc3NvYTFTQG9ha3RlY2guY29tLmJyoD4GBWBMAQMBoDUTMzAxMDIyMDA5MTIz
NDU2Nzg5MDEwMDAwMDAwMDAwMDEyMzQ1Njc4OTA5MDAwMFNTUERmIKA0BgVgTAEDBaArEykwMDAw
MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMKAXBgVgTAEDBqAOEwwwMDAwMDAw
MDAwMDAwDQYJKoZIhvcNAQEFBQADgYEAhvLu1ybn7b5VwlPhU2WwZ4Wx+e0hnnLYXzk0OJfeRRDn
E8/RbbjrD8lCNiszk8W6NINUBmyrZZIKbl4OtWS8ePS+OpZ9AFOUE0ILQzujk6LRq3qSDHhVET3j
GcIitoNhfckUHNdzTUgCPvjif2W8CjEtkVJpCsSAR39yYs1EL+Q=
-----END CERTIFICATE-----
Certificados em PEM: OK
Fim de teste de Certificados em PEM (63 ms)
 </pre>
<P>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE>java.lang.Exception</CODE></DL>
</DD>
</DL>
<HR>

<A NAME="testaCSR()"><!-- --></A><H3>
testaCSR</H3>
<PRE>
public static void <B>testaCSR</B>()
                     throws java.lang.Exception</PRE>
<DL>
<DD>Teste que permite a criação de um CSR, e a criação de um certificado a partir do CSR.
 <p>
 <pre class="brush: java;">
        public static void testaCSR() throws Exception {
                cron.zera();
                System.out.println("Testando CSR");
                try {
                        RSA rsa = new RSA1024ECB(provider);
                        KeyPair kp = rsa.generateKeyPair();
                        SignatureAlgorithm sigAlg = new SignatureAlgorithm(provider, new SHA1(provider), rsa);
                        ICPBravoCertificationRequest request = new ICPBravoCertificationRequest(provider, "CN=Ubiratan Elias, O=OAK Soluções Empresariais LTDA, OU=Desenvolvimento, L=Brasília, ST=Distrito Federal, C=BR", sigAlg, kp);
                        byte[] encodedCSR = request.getEncoded();

                        System.out.println("CSR:" + request.toString());
                        String pemEncoded = new BytesContent(encodedCSR).getPEMEncoded("CSR");
                        System.out.println(pemEncoded);
                        ICPBravoCertificationRequest recoveredCSR = new ICPBravoCertificationRequest(new PEMContent(pemEncoded, "CSR"));
                        System.out.println(recoveredCSR.getSubjectName());

                        // Gerando um certificado a partir de um CSR
                        Date from = ICPBravoUtil.getDateNow();
                        Date to = ICPBravoUtil.getTo(ICPBravoUtil.MONTHS, 1);

                        ICPBravoCertificateGenerator gen = new ICPBravoCertificateGenerator(
                                        provider, 
                                        "Pessoa 1", 
                                        BigInteger.valueOf(2), 
                                        recoveredCSR,
                                        certRoot,  
                                        ICPBravoCertificateGenerator.getDefaultKeyUsageForFinal(), 
                                        ICPBravoCertificateGenerator.getDefaultKeyPurposeForFinal(), 
                                        "http://www.certificadodigital.oaks.com.br/repositorio/lcr/SerasaSRF.crl",  
                                        OIWObjectIdentifiers.OID_ICPBrasilA3 + ".10",
                                        "http://www.certificadodigital.oaks.com.br/repositorio/dpc", 
                                        from, to,  
                                        new SignatureAlgorithm(provider, new SHA1(provider), new RSA(provider)), 
                                        "pessoa1S@oaktech.com.br", 
                                        ICPBravoUtil.getDate(2009, 1, 1), // data de nascimento
                                        "12345678901", // cpf
                                        null, // nis
                                        "12345678909", // rg
                                        "SSPDf", // oe
                                        null, // tituloEleitor
                                        null, // zona
                                        null, // sessao
                                        null, // municipioUf
                                        null // inss
                        );
                        ICPBravoCertificate cert = gen.generate(manager, true);
                        cert.verify(kp.getPublic());

                        System.out.println("CSR: OK");
                } catch (Exception e) {
                        System.out.println("CSR: : Falha " + e.getMessage());
                }
                cron.marcaTotal("Fim de teste de CSR");
        }
 </pre>
 
 O método apresenta como saída as seguintes informações:<br />
 <pre class="brush: plain;">
Testando CSR
CSR:[PKCS #10 certificate request:
Sun RSA public key, 1024 bits
  modulus: 128707597015876842290022556293750384458361619893257285761039770433645437200783477089745082977526203792473124256037853550012448431020364316579725105712373116225107711693906051535385826792663837038953639580356223403790584344745634044861625955131117603521179651234061075057289971256268058847969793112562421259551
  public exponent: 65537 subject: &lt;CN=Ubiratan Elias, O=OAK Soluções Empresariais LTDA, OU=Desenvolvimento, L=Brasília, ST=Distrito Federal, C=BR&gt;
 attributes: 0
{}
]
-----BEGIN CSR-----
MIIB2zCCAUQCAQAwgZoxCzAJBgNVBAYTAkJSMRkwFwYDVQQIExBEaXN0cml0byBGZWRlcmFsMRIw
EAYDVQQHDAlCcmFzw61saWExGDAWBgNVBAsTD0Rlc2Vudm9sdmltZW50bzEpMCcGA1UECgwgT0FL
IFNvbHXDp8O1ZXMgRW1wcmVzYXJpYWlzIExUREExFzAVBgNVBAMTDlViaXJhdGFuIEVsaWFzMIGf
MA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC3SSPFoRRp7wsD7LVeGjQFnoj9LQBjmqYKaB7JGNBe
tYmNkQx+PRDcABkYjSyrPrDdUaq0Tl3Ok10P9lX7dALwDR7pMGHLwRtqOXSx+hMCELpWjSVLLL22
ZEKmlnzjLMeIe1i28IaiXXJJ5XdReLWfHL4TY+352kE/dNmz7OjdHwIDAQABoAAwDQYJKoZIhvcN
AQEFBQADgYEAelOW614uW24qbyXX4+FJ+JFoksu1DxpZS7dYK62xML1PlfVBRQFGpeSpQYvYKo21
+nyHX/gowU17cPbB3XxBTyspaNSm+PA7J3sNy50544o8Qfnu7JqWWYigKlOQQCAlHNAoinILO+A5
0M7NT/+oaovCRPM1h0cFkA+FCbUQ2V4=
-----END CSR-----
CN=Ubiratan Elias, O=OAK Soluções Empresariais LTDA, OU=Desenvolvimento, L=Brasília, ST=Distrito Federal, C=BR
CSR: OK
Fim de teste de CSR (4947 ms)
 </pre>
<P>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE>java.lang.Exception</CODE></DL>
</DD>
</DL>
<HR>

<A NAME="main(java.lang.String[])"><!-- --></A><H3>
main</H3>
<PRE>
public static void <B>main</B>(java.lang.String[]&nbsp;args)
                 throws java.lang.Exception</PRE>
<DL>
<DD>Roda os testes.
<P>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>args</CODE> - 
<DT><B>Throws:</B>
<DD><CODE>java.lang.Exception</CODE></DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>

					
					<img src=../../../../../../img/LogoGrande.png><br>
					<b>Vers&atilde;o 1.20</b></a>
					
				</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;<A HREF="../../../../br/com/oaks/ICPBravo/AlvoDigital.html" title="class in br.com.oaks.ICPBravo"><B>PREV CLASS</B></A>&nbsp;
&nbsp;<A HREF="../../../../br/com/oaks/ICPBravo/Exemplos.SSLClientImpl.html" title="class in br.com.oaks.ICPBravo"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../../../index.html?br/com/oaks/ICPBravo/Exemplos.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="Exemplos.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;<A HREF="#nested_class_summary">NESTED</A>&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>

					<a href='www.oaks.com.br'><b>OAK Solu&ccedil;&otilde;es Empresariais em Inform&aacute;tica LTDA, 2010</b></a>
				
</BODY>
</HTML>
