<html>
<header>
	<link href="icpbravo.css" rel="stylesheet" type="text/css" />
	<title>ICPBravo - Segurança</title>
	<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
</header>
<body>
	<table width='100%'><tr>
	<td align='left'><a href='index.html'><img src='../img/LogoGrande.png' border='0'></a></td>
	<td align='right'><h1><a href='http://www.oaks.com.br'>OAK Soluções Empresariais</a></h1></td>
	</tr>
	</table>
<h1>Segurança da API ICP-Bravo</h1>
<p>A API ICPBravo implementa alguns dispositivos de segurança de forma a diminuir os riscos de segurança com o uso da API.</p>
<p>Em primeiro lugar, o jar distribuido pela OAK recebe a assinatura de um certificado emitido pela SUN em nome da OAK Soluções Empresariais. 
<br>Esta característica é importante pois a máquina virtual da SUN impede que aplicações não assinadas possam implementar rotinas de provedores de algoritmos de segurança.
<br>Além disso, para que um applet tenha autorização para acessar algumas características na estação local do cliente, como leitura e escrita de arquivos no sistema de arquivos, também é necessário que este applet receba uma assinatura e que, no momento 
em que é inicializado, receba uma autorização do cliente informando que o certificado que está sendo apresentado seja um certificado de confiança.
<br>Por isso é muito importante instalar este certificado da OAK na raiz de confiança das máquinas que utilizarão o jar de forma a garantir que somente a API legítima entre em operação.</p>
<p>Existe também um segundo dispositivo de segurança instalado na API que faz com que seja extraído um hash de todas as classes da API e de classes acessórias invocadas por esta, por meio de função HMAC/SHA-1, onde este hash é assinado no momento do empacotamento da API para o contratante, por um certificado emitido pela OAK em favor do contratante da API.<br>
Ainda como forma de garantir que nenhum algoritimo da API tenha tido violado, também são realizados testes no momento da inicialização da API de forma a garantir que seus algoritimos estejam funcionando corretamente, onde resultados esperados são confrontados contra os produzidos pelos algoritimos da ICP-Bravo.<br>
São testados neste momento os algoritimos criptográficos simétricos e assimétricos, os algoritimos de digest e os de geração de números aleatórios.<br>
Tanto a assinatura como a integridade dos algoritmos da API são verificados toda vez que a API é inicializada e, caso não sejam válidos, o funcionamento da API é abortado encerrando-se a máquina virtual Java e enviando mensagem de erro ao console.<br>
Caso a assinatura possa ser verficada corretamente, é possível identificar a origem da API, informando os dados da contratante.</p>
<p>Estes mecanismos impedem que trechos de programas da API sejam alterados de forma maliciosa, fazendo com que as operações da API possam ser corrompidas gerando hashs, chaves, assinaturas ou criptografias fraudulentas, o que acarretaria em graves consequências na utilização da certificação digital.</p>
<p>Além das chamadas automáticas aos mecanismos de segurança, também é possível invocar a verificação de integridade a qualquer momento pela chamada dos métodos estáticos <pre>APISignature.verifyAPIIntegrityOrExit()</pre> ou <pre>APISignature.verifyAPIIntegrity()</pre>. Veja mais na <a href='./javadoc/br/com/oaks/ICPBravo/manager/APISignature.html'>documentação da API</a>.</p>

<h1>Segurança SUN/Java</h1>
<p>A máquina virtual JAVA da Sun também tem requisitos de segurança que devem ser observados ao se rodar aplicações em Java.</p>
<p>Um destes requisitos se faz presente ao rodar aplicações em applet, onde a aplicação roda na máquina virtual instalada nas máquinas clientes (JRE).
Pela configuração default instalada na máquina cliente, o JRE impede que seja feito qualquer acesso a uma URL (Uniform Resource Locator) externa ao servidor. Como a aplicação tem a necessidade de validar os LCR (Lista de Certificados Revogados) na estação cliente, faz-se necessário o acesso a URLs externas. Para que seja possível executar estas operações, é necessário alterar um arquivo de configuração presente na máquina cliente.<p>
É necessário editar o arquivo <i>&lt;JAVA_HOME&gt;/lib/security/java.policy</i>, onde será necessário acrescentar a seguintes linha:
<br>
<pre>
	permission java.net.SocketPermission "*", "connect, resolve";
</pre> 
<p>Esta linha informa a máquina virtual que ela pode acessar (connect e resolve) para qualquer URL, e não somente ao servidor, como vem na configuração default.</p>
<p>Como esta alteração envolve um esforço muito grande de parametrização nas máquinas clientes, uma alternativa a este processo é implementar na estrutura de servidores um gateway que recebe as solicitações de verificação de CRL no servidor e acessa as URLs externas apenas pelo servidor. Isto traz alguns benefícios, como o de armazenamento de cache dos CRLs na estrutura do servidor, evitando desperdício de tráfego a rede externa. (para obter mais sobre este assunto, veja parêmtro &lt;GatewayVerificacaoCRL&gt; na configuração do applet)</p>
<br>
<p>Outra alteração é necessária para rodar aplicações que usem algoritmos de criptografia que excedam 128 bits (no caso de algoritmo simétrico, exceto o triple-DES) ou 1024 bits para o caso de algoritmos assimétricos. que pode ocasionar o seguinte erro:
<br>
<pre>
java.lang.SecurityException
Unsupported keysize or algorithm parameters 
</pre></p>
<p>Para estes casos é necessário a instalação de uma política, fornecida pela própria SUN, chamada JCE Unlimited Strength Jurisdiction Policy File. Para isso, baixe o arquivo <i>jce_policy-6.zip</i> diretamente do site da SUN e descompacte-o sobre o diretório <i>&lt;JAVA_HOME&gt;/lib/security/</i>.</p>
<p>No caso de se fazer necessário o uso da API por meio de chamadas do provider via strings (<i>ex.: Cipher cipher = Cipher.getInstance("DES/CBC/PKCS5PADDING“,"ICPBRAVO");</i>), também é necessário a instalação de uma linha no arquivo <i>&lt;JAVA_HOME&gt;/lib/security/java.security</i>, dentro do bloco que faz referência aos providers, com a seguinte sintaxe:
<pre>
security.provider.&lt;SEQ&gt;= br.com.oaks.ICPBravo.provider.ICPBravoProvider
</pre>
Onde &lt;SEQ&gt; é a ordem que gostaria que o provider fosse encontrado.
<br>Seguindo as recomendações da SUN, é recomendável que acrescente a linha após as linhas da SUN, para evitar que outras aplicações que já se utilizam de algorítimos da SUN parem de funcionar corretamente, como applets de acesso a banco ou semelhantes.
</p>
</body>
</html>
